<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MLS4YOU #2 ‚Äî Accueillir</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700;800&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>

  <style>
    :root { --red:#C62828; --yellow:#FFC928; --turq:#20B8AE; --mint:#BFEFE8; --orange:#FFB067; --bg:#FFF9F0; --ink:#101114; --muted:rgba(16,17,20,.7); --max:980px; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:'Montserrat',system-ui,-apple-system,sans-serif;overflow-x:hidden}
    h1,h2,h3{font-family:'Baloo 2',cursive;font-weight:800;margin:0}
    .bg-shapes{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
    .bg-circle{position:absolute;border-radius:999px;filter:blur(2px);opacity:.8}
    .c-mint{width:400px;height:400px;left:-100px;top:-100px;background:var(--mint);opacity:.9}
    .c-yellow{width:350px;height:350px;right:-100px;top:15%;background:rgba(255,201,40,.5)}
    .c-orange{width:450px;height:450px;left:-150px;bottom:0;background:rgba(255,176,103,.4)}
    .c-red{width:300px;height:300px;right:-50px;bottom:-50px;background:rgba(198,40,40,.25)}
    .wrap{position:relative;z-index:1;max-width:var(--max);margin:22px auto 28px;padding:0 16px 26px}
    .frame{border-radius:24px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden;border:5px solid transparent;background-image:linear-gradient(rgba(255,255,255,.95),rgba(255,255,255,.95)),linear-gradient(135deg,var(--red),var(--yellow),var(--turq));background-origin:border-box;background-clip:padding-box,border-box}
    .hero{position:relative;border-bottom:4px solid var(--turq);padding:16px;background:#fff}
    .hero-inner{position:relative;border-radius:18px;overflow:hidden;min-height:clamp(120px,22vw,170px);display:flex;align-items:center;padding:22px 28px}
    .header-pattern{position:absolute;inset:0;background:#fdfdfd;z-index:0}
    .hs{position:absolute;border-radius:50%;opacity:.65;mix-blend-mode:multiply}
    .hs-1{background:var(--red);width:140px;height:140px;top:-40px;left:10%}
    .hs-2{background:var(--yellow);width:180px;height:180px;bottom:-60px;right:20%}
    .hs-3{background:var(--turq);width:120px;height:120px;top:20px;right:40%}
    .hs-4{background:var(--mint);width:90px;height:90px;bottom:10px;left:30%}
    .hs-5{background:var(--orange);width:70px;height:70px;top:60px;left:45%}
    .header-content{position:relative;z-index:10;display:flex;width:100%;justify-content:space-between;align-items:flex-start}
    .logo-left,.logo-right{display:flex;z-index:20}
    .logo-left{margin-top:-12px;margin-left:-16px}
    .logo-right{margin-top:-12px;margin-right:-16px}
    .header-logo{height:58px;object-fit:contain;mix-blend-mode:multiply;filter:drop-shadow(0 4px 6px rgba(0,0,0,.05))}
    .title-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:15}
    .hero-title{font-size:clamp(28px,3.6vw,38px);color:var(--red);line-height:1;text-shadow:-3px -3px 0 #fff,3px -3px 0 #fff,-3px 3px 0 #fff,3px 3px 0 #fff,0 8px 16px rgba(0,0,0,.12)}
    .hero-title small{display:block;font-family:'Montserrat',sans-serif;font-size:clamp(12px,1.8vw,16px);color:var(--ink);text-transform:uppercase;letter-spacing:.05em;margin-top:8px;text-shadow:-2px -2px 0 #fff,2px -2px 0 #fff,-2px 2px 0 #fff,2px 2px 0 #fff}

    .content{background:#fff;padding:18px 16px 14px}
    .toprow{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .back{display:inline-flex;align-items:center;gap:8px;text-decoration:none;font-weight:800;padding:10px 12px;border-radius:999px;background:#fff;border:2px solid rgba(16,17,20,.08);box-shadow:0 2px 4px rgba(0,0,0,.05)}
    .back:hover{transform:translateY(-1px)}
    .progress-wrap{flex:1;min-width:240px;max-width:420px;background:rgba(0,0,0,.06);border-radius:999px;overflow:hidden;height:12px}
    .progress{height:100%;width:0%;background:var(--turq);transition:width .3s ease}
    .progress-meta{font-weight:800;font-size:12px;color:var(--muted)}

    .panel{margin-top:14px;border-radius:18px;border:3px solid rgba(16,17,20,.08);box-shadow:0 8px 16px rgba(16,17,20,.06);overflow:hidden}
    .panel-h{padding:14px 14px;background:rgba(191,239,232,.25);display:flex;align-items:center;justify-content:space-between;gap:10px}
    .panel-h h2{font-size:18px}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#fff;border:2px solid rgba(16,17,20,.08);font-weight:900;font-size:11px}
    .panel-b{padding:14px}
    .hint{color:var(--muted);font-weight:600;font-size:13px;line-height:1.4}

    .cardset{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .opt{border-radius:16px;border:2px solid rgba(16,17,20,.10);background:#fff;padding:12px;cursor:pointer;transition:.15s;min-height:78px}
    .opt:hover{transform:translateY(-2px);box-shadow:0 10px 18px rgba(0,0,0,.08)}
    .opt strong{display:block}
    .opt small{display:block;margin-top:6px;color:var(--muted);font-weight:600}
    .opt[data-on="1"]{border-color:var(--turq);box-shadow:0 0 0 4px rgba(32,184,174,.15)}
    .story{margin-top:12px;padding:12px;border-radius:16px;background:rgba(0,0,0,.05);border-left:5px solid var(--turq);color:var(--muted);font-weight:600;line-height:1.5}
    .ml-tip{margin-top:12px;padding:12px;border-radius:16px;background:rgba(255,201,40,.14);border-left:5px solid var(--yellow);color:rgba(16,17,20,.78);font-weight:700;line-height:1.5}

    .field{margin-top:12px}
    textarea,input{width:100%;padding:12px;border-radius:14px;border:2px solid rgba(16,17,20,.12);font:inherit;font-weight:600}
    textarea{min-height:86px;resize:vertical}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:14px;border:none;font-weight:900;cursor:pointer;text-transform:uppercase;letter-spacing:.05em;box-shadow:0 4px 12px rgba(0,0,0,.10)}
    .btn.primary{background:var(--turq);color:#fff}
    .btn.ghost{background:#fff;border:2px solid rgba(16,17,20,.12);color:var(--ink);box-shadow:0 2px 4px rgba(0,0,0,.05)}
    .btn.warn{background:var(--red);color:#fff}
    .mini{font-size:12px;color:var(--muted);font-weight:700}

    .badgebox{margin-top:14px;padding:12px;border-radius:18px;background:linear-gradient(90deg,rgba(32,184,174,.12),rgba(255,201,40,.12));border:2px solid rgba(16,17,20,.10)}
    .badges{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .badge{display:inline-flex;align-items:center;gap:10px;padding:10px 12px;border-radius:16px;background:#fff;border:2px solid rgba(16,17,20,.10);font-weight:900}
    .dot{width:14px;height:14px;border-radius:999px;background:rgba(0,0,0,.08)}
    .badge[data-on="1"] .dot{background:var(--turq)}
    .badge small{display:block;color:var(--muted);font-weight:700}

    .frieze{display:flex;gap:12px;padding:0 20px;margin-top:10px;margin-bottom:24px;background:#fff}
    .capsule{height:16px;border-radius:999px;flex:1;box-shadow:inset 0 2px 4px rgba(0,0,0,.1)}
    .eu{margin:0 20px 20px;border-radius:20px;background:#fff;border:3px solid rgba(16,17,20,.08);box-shadow:0 10px 20px rgba(16,17,20,.05);padding:20px;text-align:center}
    .eu-logo{height:65px;mix-blend-mode:multiply;filter:drop-shadow(0 4px 6px rgba(0,0,0,.05))}
    .eu p{margin:8px auto 0;max-width:90ch;font-size:12px;line-height:1.6;color:var(--muted);font-weight:500}
    .eu .copyright{color:var(--ink);font-weight:800;font-size:12px;margin-top:4px}
    .eu .link{display:inline-block;margin-top:12px;color:var(--turq);font-weight:900;text-decoration:none;font-size:13px}
    .eu .link:hover{text-decoration:underline;color:var(--red)}

    @media(max-width:760px){
      .title-center{position:relative;top:auto;left:auto;transform:none;width:100%;margin-top:10px}
      .cardset{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div class="bg-shapes" aria-hidden="true">
    <div class="bg-circle c-mint"></div>
    <div class="bg-circle c-yellow"></div>
    <div class="bg-circle c-orange"></div>
    <div class="bg-circle c-red"></div>
  </div>

  <main class="wrap">
    <section class="frame">

      <header class="hero">
        <div class="hero-inner">
          <div class="header-pattern" aria-hidden="true">
            <div class="hs hs-1"></div><div class="hs hs-2"></div><div class="hs hs-3"></div><div class="hs hs-4"></div><div class="hs hs-5"></div>
          </div>

          <div class="header-content">
            <div class="logo-left">
              <img src="https://static.wixstatic.com/media/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif/v1/fill/w_224,h_60,al_c,q_80,enc_avif,quality_auto/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif" alt="Logo Mission Locale Pays Basque" class="header-logo" loading="lazy" />
            </div>

            <div class="title-center">
              <h1 class="hero-title">ACCUEILLIR<small>Ton super-pouvoir relationnel ‚Äî ~1h</small></h1>
            </div>

            <div class="logo-right">
              <img src="https://www.lifeskills4youth.eu/wp-content/uploads/2024/07/LS4YOU_Logo.png" alt="Logo LS4YOU" class="header-logo" loading="lazy" />
            </div>
          </div>
        </div>
      </header>

      <section class="content">
        <div class="toprow">
          <a class="back" href="./index.html"><i data-lucide="arrow-left"></i> Retour</a>

          <div class="progress-wrap" aria-label="progression">
            <div id="progress" class="progress"></div>
          </div>
          <div class="progress-meta"><span id="pct">0%</span> compl√©t√©</div>
        </div>

        <div class="badgebox">
          <div style="font-weight:900;">Objectif du pilier</div>
          <div class="hint">
            Transformer la m√©fiance en <strong>reliance</strong>, prendre ta place, et ma√Ætriser 3 rituels simples.
            Tu d√©bloques le badge <strong>RELIEUR</strong> quand tu valides <strong>7 cartes</strong> + que tu √©cris <strong>1 ajustement concret</strong>.
          </div>
          <div class="badges">
            <div class="badge" id="b-relieur"><span class="dot"></span>RELIEUR <small>Accueillir valid√©</small></div>
          </div>
        </div>

        <!-- MICROLEARNING + JEU EXP√âRIENTIEL -->
        <div class="panel" data-step="1">
          <div class="panel-h">
            <h2>Ton super-pouvoir relationnel (NotebookLM Audio Overview)</h2>
            <span class="chip"><i data-lucide="headphones"></i>7 cartes</span>
          </div>

          <div class="panel-b">
            <div class="hint">
              Si tu crois que ‚Äúaccueillir‚Äù = juste √™tre poli, tu rates ton arme secr√®te.
              Ici, tu vas apprendre √† <strong>d√©sarmer la m√©fiance</strong> et √† cr√©er de la <strong>reliance</strong> pour t‚Äôint√©grer et avancer vers 2040.
            </div>

            <div class="ml-tip">
              <strong>Mode d‚Äôemploi :</strong> clique une carte ‚Üí lis l‚Äôaudio ‚Üí fais l‚Äôaction ‚Üí valide la carte.
              <br>Ensuite : le <strong>Miroir Pro</strong> te montre l‚Äô√©cart entre l‚Äôimage que tu veux renvoyer et ce que tes gestes envoient vraiment.
            </div>

            <!-- NAV 7 CARTES -->
            <div style="margin-top:14px;font-weight:900;">Tes 7 cartes</div>
            <div class="hint">Clique une carte pour l‚Äôouvrir. Tu peux revenir quand tu veux.</div>

            <div class="cardset" id="cards7" style="margin-top:10px;">
              <div class="opt" data-card="1"><strong>Carte 1</strong><small>Pourquoi l'accueil change tout</small></div>
              <div class="opt" data-card="2"><strong>Carte 2</strong><small>La magie de la RELIANCE</small></div>
              <div class="opt" data-card="3"><strong>Carte 3</strong><small>Posture d‚Äôaccueil r√©ciproque</small></div>
              <div class="opt" data-card="4"><strong>Carte 4</strong><small>Plaza Hartzea (prendre sa place)</small></div>
              <div class="opt" data-card="5"><strong>Carte 5</strong><small>Les 3 rituels d‚Äôaccueil</small></div>
              <div class="opt" data-card="6"><strong>Carte 6</strong><small>Ton 1er r√©seau solidaire</small></div>
              <div class="opt" data-card="7"><strong>Carte 7</strong><small>Ton badge RELIEUR</small></div>
            </div>

            <!-- LECTEUR CARTE -->
            <div class="badgebox" style="margin-top:14px;">
              <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                <div style="font-weight:900;" id="cardTitle">Choisis une carte</div>
                <div class="chip"><i data-lucide="sparkles"></i><span id="cardMeta">Microlearning</span></div>
              </div>

              <div id="cardVisual" class="story" style="margin-top:10px;">
                <strong>Visuel :</strong> ‚Äî
              </div>

              <div id="cardAudio" class="story" style="margin-top:10px;">
                <strong>Audio (45‚Äì60s) :</strong> clique une carte pour afficher le texte audio.
              </div>

              <div id="cardAction" class="story" style="margin-top:10px;">
                <strong>Action flash :</strong> clique une carte pour afficher le d√©fi.
              </div>

              <div class="actions" style="margin-top:12px;">
                <button class="btn primary" onclick="validateCurrentCard()"><i data-lucide="check"></i> Valider cette carte</button>
                <button class="btn ghost" onclick="markAsDoneLater()"><i data-lucide="bookmark"></i> Je le fais plus tard</button>
              </div>

              <div class="mini" style="margin-top:8px;">
                Cartes valid√©es : <strong><span id="cardsDone">0</span>/7</strong>
              </div>
            </div>

            <!-- JEU MIROIR -->
            <div class="panel" style="margin-top:14px;border-width:2px;">
              <div class="panel-h" style="background:rgba(32,184,174,.12);">
                <h2 style="font-size:16px;">Jeu ‚Äî Le Miroir Pro (image de soi vs image renvoy√©e)</h2>
                <span class="chip"><i data-lucide="scan-face"></i>Miroir</span>
              </div>
              <div class="panel-b">
                <div class="hint">
                  <strong>But insertion :</strong> aligner l‚Äôimage que tu veux donner avec ce que tes gestes envoient.
                  <br>Pas de note. Juste un miroir + 1 ajustement concret.
                </div>

                <div style="margin-top:10px;font-weight:900;">1) Comment tu veux √™tre per√ßu (choisis 3 cartes)</div>
                <div class="hint">Choisis <strong>3</strong> mots-cl√©s.</div>

                <div class="cardset" id="selfCards">
                  <div class="opt" data-mode="self" data-v="fiable"><strong>Fiable</strong><small>Je fais ce que je dis.</small></div>
                  <div class="opt" data-mode="self" data-v="calme"><strong>Calme</strong><small>Je garde mon sang-froid.</small></div>
                  <div class="opt" data-mode="self" data-v="ouvert"><strong>Ouvert</strong><small>Je vais vers les autres.</small></div>
                  <div class="opt" data-mode="self" data-v="respect"><strong>Digne</strong><small>√âgal √† √©gal.</small></div>
                  <div class="opt" data-mode="self" data-v="curieux"><strong>Curieux</strong><small>Je pose des questions.</small></div>
                  <div class="opt" data-mode="self" data-v="place"><strong>Je prends ma place</strong><small>Je ne reste pas invisible.</small></div>
                </div>

                <div id="selfPickInfo" class="story" style="display:none;"></div>

                <div style="margin-top:12px;font-weight:900;">2) 3 sc√®nes (tu choisis 1 action par sc√®ne)</div>

                <div class="panel" style="margin-top:10px;border-width:2px;">
                  <div class="panel-h" style="background:rgba(255,201,40,.18);">
                    <h2 style="font-size:16px;">Sc√®ne 1 ‚Äî Premi√®re seconde (salut)</h2>
                    <span class="chip"><i data-lucide="hand"></i>Accueil</span>
                  </div>
                  <div class="panel-b">
                    <div class="cardset" id="scene1">
                      <div class="opt" data-mode="s1" data-v="rituel"><strong>Regard + bonjour + sourire</strong><small>Je casse la m√©fiance.</small></div>
                      <div class="opt" data-mode="s1" data-v="faible"><strong>Bonjour faible / √©vite le regard</strong><small>Je me prot√®ge.</small></div>
                      <div class="opt" data-mode="s1" data-v="tel"><strong>T√©l√©phone / distance</strong><small>Je g√®re mon stress.</small></div>
                      <div class="opt" data-mode="s1" data-v="trop_familier"><strong>Trop familier</strong><small>Je veux briser la glace vite.</small></div>
                    </div>
                  </div>
                </div>

                <div class="panel" style="margin-top:10px;border-width:2px;">
                  <div class="panel-h" style="background:rgba(32,184,174,.12);">
                    <h2 style="font-size:16px;">Sc√®ne 2 ‚Äî R√©ciprocit√© (√©gal √† √©gal)</h2>
                    <span class="chip"><i data-lucide="scale"></i>Dignit√©</span>
                  </div>
                  <div class="panel-b">
                    <div class="cardset" id="scene2">
                      <div class="opt" data-mode="s2" data-v="question_active"><strong>Je demande un conseil</strong><small>Question active, respect.</small></div>
                      <div class="opt" data-mode="s2" data-v="subit"><strong>J‚Äôattends qu‚Äôon me guide</strong><small>Je subis.</small></div>
                      <div class="opt" data-mode="s2" data-v="sec"><strong>Droit au but sec</strong><small>√áa peut fermer.</small></div>
                      <div class="opt" data-mode="s2" data-v="trop_efface"><strong>Je m‚Äôefface</strong><small>Je deviens invisible.</small></div>
                    </div>
                  </div>
                </div>

                <div class="panel" style="margin-top:10px;border-width:2px;">
                  <div class="panel-h" style="background:rgba(255,176,103,.16);">
                    <h2 style="font-size:16px;">Sc√®ne 3 ‚Äî Plaza Hartzea (prendre sa place)</h2>
                    <span class="chip"><i data-lucide="users"></i>Groupe</span>
                  </div>
                  <div class="panel-b">
                    <div class="cardset" id="scene3">
                      <div class="opt" data-mode="s3" data-v="prise_parole"><strong>Je pose 1 question</strong><small>J‚Äôexiste dans le groupe.</small></div>
                      <div class="opt" data-mode="s3" data-v="silence"><strong>Je reste silencieux</strong><small>Je me coupe.</small></div>
                      <div class="opt" data-mode="s3" data-v="valide"><strong>Je valide une id√©e</strong><small>Je renforce le collectif.</small></div>
                      <div class="opt" data-mode="s3" data-v="ironique"><strong>Ironie / distance</strong><small>√áa peut casser le lien.</small></div>
                    </div>
                  </div>
                </div>

                <div class="badgebox" style="margin-top:12px;">
                  <div style="font-weight:900;">Ton miroir</div>
                  <div class="hint">Quand tu as 3 mots-cl√©s + 3 sc√®nes, le miroir s‚Äôaffiche.</div>

                  <div id="mirrorBox" class="story" style="display:none;"></div>

                  <div class="field" style="margin-top:12px;">
                    <label class="mini" for="mirrorAction">Mon micro-ajustement (30 secondes) :</label>
                    <textarea id="mirrorAction" placeholder="Ex : ‚ÄúRegard + pr√©nom + 1 question ouverte.‚Äù"></textarea>
                  </div>

                  <div class="actions">
                    <button class="btn primary" onclick="saveMirror()"><i data-lucide="save"></i> Enregistrer</button>
                    <button class="btn ghost" onclick="autoSuggestMirror()"><i data-lucide="wand-2"></i> Suggestion</button>
                  </div>
                </div>

              </div>
            </div>

            <!-- FIN -->
            <div class="badgebox" style="margin-top:14px;">
              <div style="font-weight:900;">Badge RELIEUR</div>
              <div class="hint">
                Le badge s‚Äôactive quand :
                <br>‚úÖ tu as valid√© <strong>7/7 cartes</strong>
                <br>‚úÖ tu as √©crit <strong>1 micro-ajustement</strong> dans le miroir
              </div>
              <div class="actions" style="margin-top:10px;">
                <button class="btn warn" onclick="finishAccueillir()"><i data-lucide="trophy"></i> Terminer ACCUEILLIR</button>
              </div>
            </div>

          </div>
        </div>

      </section>

      <div class="frieze" aria-hidden="true">
        <div class="capsule" style="background: var(--yellow);"></div>
        <div class="capsule" style="background: var(--turq);"></div>
        <div class="capsule" style="background: var(--red);"></div>
        <div class="capsule" style="background: var(--mint);"></div>
      </div>

      <footer class="eu" aria-label="Mentions UE">
        <div class="eu-top">
          <img src="https://www.immigration.interieur.gouv.fr/var/miomcti/storage/images/media/mi/images/logos-pictos/cofinance-par-l-union-europeenne-v/1060317-1-fre-FR/Cofinance-par-l-Union-europeenne-V.png" alt="Cofinanc√© par l'Union europ√©enne" class="eu-logo" loading="lazy">
        </div>
        <div class="copyright">¬© 2026 LS4YOU Project Nr. 2023-2-FR02-KA220-YOU-000175417</div>
        <p>Funded by the European Union. Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the Agence Erasmus+ France Jeunesse &amp; Sport (Agence du Service Civique). Neither the European Union nor the granting authority can be held responsible for them.</p>
        <a class="link" href="#" onclick="return false;">Data Privacy Statement &amp; Imprint</a>
      </footer>

    </section>
  </main>

  <script>
    const KEY="mls4you_territoire_v1";
    function readState(){ try{return JSON.parse(localStorage.getItem(KEY))||{} }catch{return{}} }
    function writeState(s){ localStorage.setItem(KEY, JSON.stringify(s)); }
    function ensure(){
      const s=readState();
      s.badges=s.badges||{relieur:false,createur:false,ancre:false,robuste:false};
      s.done=s.done||{accueillir:false,creer:false,habiter:false,soin:false};
      s.profile=s.profile||{};
      s.accueillir=s.accueillir||{};
      s.accueillir.cards = s.accueillir.cards || { done:{1:false,2:false,3:false,4:false,5:false,6:false,7:false}, current:1 };
      s.accueillir.miroir = s.accueillir.miroir || { self:[], s1:null, s2:null, s3:null, result:null, action:null };
      writeState(s); return s;
    }
    const S=ensure();

    function setProgress(){
      const cardsDone = Object.values(S.accueillir.cards.done).filter(Boolean).length; // /7
      const mirrorDone = !!(S.accueillir.miroir.action && S.accueillir.miroir.action.trim());
      const steps = cardsDone + (mirrorDone ? 1 : 0);
      const total = 8;
      const pct = Math.round((steps/total)*100);

      document.getElementById("progress").style.width = pct + "%";
      document.getElementById("pct").textContent = pct + "%";

      const b=document.getElementById("b-relieur");
      b.dataset.on = (S.badges.relieur || S.done.accueillir) ? "1" : "0";
    }

    // ----------------- 7 CARTES (MICROLEARNING) -----------------
    const ACCUEILLIR_CARDS = {
      1: {
        title: "CARTE 1 : Pourquoi l'accueil change tout",
        visual: "Un contact visuel franc et une posture ouverte lors d'une rencontre.",
        audio: "√âcoute bien : chaque inconnu est une porte ferm√©e √† double tour par la m√©fiance. Ton super-pouvoir, c‚Äôest l‚Äôaccueil. En envoyant les bons signaux d√®s les premi√®res secondes, tu ne fais pas que dire bonjour, tu dis : ‚ÄúJe connais les codes, tu peux me faire confiance‚Äù. Ce n'est pas √™tre soumis, c'est √™tre strat√®ge. C‚Äôest toi qui d√©cides que la rencontre va bien se passer. C'est ta force pour entrer dans n'importe quelle √©quipe.",
        action: "Ton d√©fi : salue et souris √† trois personnes inconnues aujourd'hui (boulangerie, bus, Mission Locale). Observe comment leur visage change."
      },
      2: {
        title: "CARTE 2 : La magie de la RELIANCE",
        visual: "Deux maillons de fer qui se soudent pour former une cha√Æne indestructible.",
        audio: "En Iparralde, on bouge tout le temps. Entre ceux qui s'installent et ceux qui ne font que passer, le risque c'est que tout le monde reste dans son coin. La reliance, c'est ton antenne sociale. C'est transformer cette foule en communaut√©. Si tu sais parler √† quelqu'un qui ne te ressemble pas, tu deviens indispensable. Les entreprises cherchent des gens qui ‚Äúfont du lien‚Äù. Ne reste pas spectateur de ce changement, sois celui qui soude le groupe.",
        action: "Entre dans un commerce ou un lieu de ton quartier o√π tu ne vas jamais. Regarde, puis dis un ‚ÄúBonjour‚Äù clair en partant."
      },
      3: {
        title: "CARTE 3 : La posture d'Accueil R√©ciproque",
        visual: "Un √©change √©quilibr√© entre un professionnel et un client, dos droit, regard horizontal.",
        audio: "Ne confonds pas accueil et servilit√©. Accueillir, c'est prendre les commandes. Quand tu re√ßois quelqu'un, c'est toi qui diriges l'√©change avec dignit√©. Et quand c'est toi qui arrives, montre que tu respectes le lieu et les gens qui y sont d√©j√†. C'est √ßa la r√©ciprocit√© : j'accepte qui tu es, tu acceptes qui je suis. C'est une question de respect mutuel, et c'est toi qui donnes le ton.",
        action: "Dans un commerce : ‚ÄúBonjour, est-ce que vous auriez un conseil pour ce produit ?‚Äù ou un ‚ÄúBonne journ√©e‚Äù bien senti en regardant la personne."
      },
      4: {
        title: "CARTE 4 : Prendre SA place (Plaza Hartzea)",
        visual: "Un jeune qui s'avance au centre d'un cercle de discussion lors d'un atelier.",
        audio: "En Iparralde, la place appartient √† ceux qui l'occupent. ‚ÄúPlaza Hartzea‚Äù, c'est oser dire : ‚ÄúJe suis l√†‚Äù. Ne demande pas la permission d'exister dans un groupe. En apportant ta voix, tu accueilles le collectif et tu lui donnes de la force. Le silence est un mur, la parole est une porte. Prends ce courage : c'est en prenant ta place que tu deviens un membre reconnu de la communaut√©.",
        action: "Lors de ta prochaine r√©union/atelier, sois le premier √† prendre la parole pour poser une question ou valider l'id√©e d'un autre."
      },
      5: {
        title: "CARTE 5 : Les 3 rituels d'Accueil",
        visual: "Trois ic√¥nes : un ≈ìil (regard), une bulle (nom), un point d'interrogation (question).",
        audio: "Voici ton kit de survie social en trois √©tapes. Rituel 1 : le regard. Fixe les yeux sans provoquer : signal ‚Äúje suis en confiance‚Äù. Rituel 2 : le nom. Donne ton pr√©nom et retiens celui de l'autre : on n'est plus des inconnus. Rituel 3 : la question ouverte. Demande ‚ÄúComment ?‚Äù ou ‚ÄúQuoi ?‚Äù pour lancer la discussion. En 30 secondes, tu as cass√© la glace et tu ma√Ætrises le terrain.",
        action: "Applique Regard / Nom / Question d√®s ton prochain rendez-vous (conseiller, voisin, commerce)."
      },
      6: {
        title: "CARTE 6 : Ton 1er r√©seau solidaire",
        visual: "Une carte reliant un jeune √† un commer√ßant, un voisin √¢g√© et un acteur local.",
        audio: "Ton r√©seau, c'est ton filet de s√©curit√©. En Iparralde, la solidarit√© n'est pas un vain mot. Accueillir les besoins d'un voisin √¢g√© ou s'int√©resser au travail d'un ancien, c'est poser des briques pour ton propre avenir. Un jour, c'est ce r√©seau qui te donnera le bon tuyau pour un job ou un logement. Ne reste pas dans ton coin : cr√©e des liens avec ceux qui t'ont pr√©c√©d√©. C'est √ßa, pr√©parer 2040.",
        action: "Micro-conversation avec une personne d'une autre g√©n√©ration dans ton quartier : demande son avis sur un sujet local."
      },
      7: {
        title: "CARTE 7 : Ton badge RELIEUR",
        visual: "Un badge ‚ÄúRELIEUR‚Äù avec cases coch√©es : Rituels, Place, Reliance.",
        audio: "Tu as les cl√©s en main. Ton badge de Relieur est activ√© d√®s que tu oses aller vers l'autre. C'est cette force qui te fera sortir du lot en entretien. Tu n'es pas juste un candidat : tu es celui qui sait souder une √©quipe. Partage tes succ√®s avec ton conseiller. N'oublie jamais : en 2040, ce sont les relieurs qui m√®neront la danse dans un monde qui change. √Ä toi de jouer !",
        action: "Prends rendez-vous avec ton conseiller Mission Locale : raconte comment tu as utilis√© ton pouvoir de ‚ÄúRelieur‚Äù pour ton prochain stage/emploi."
      }
    };

    function showCard(n){
      S.accueillir.cards.current = n;
      writeState(S);

      document.getElementById("cardTitle").textContent = ACCUEILLIR_CARDS[n].title;
      document.getElementById("cardVisual").innerHTML = "<strong>Visuel :</strong> " + ACCUEILLIR_CARDS[n].visual;
      document.getElementById("cardAudio").innerHTML = "<strong>Audio (45‚Äì60s) :</strong> ‚Äú" + ACCUEILLIR_CARDS[n].audio + "‚Äù";
      document.getElementById("cardAction").innerHTML = "<strong>Action flash :</strong> " + ACCUEILLIR_CARDS[n].action;

      // highlight selected card
      document.querySelectorAll("#cards7 .opt").forEach(x=>x.dataset.on="0");
      const btn = document.querySelector(`#cards7 .opt[data-card="${n}"]`);
      if(btn) btn.dataset.on="1";

      refreshCardsDone();
    }

    function refreshCardsDone(){
      const done = Object.values(S.accueillir.cards.done).filter(Boolean).length;
      document.getElementById("cardsDone").textContent = done;
      setProgress();
    }

    function validateCurrentCard(){
      const n = S.accueillir.cards.current || 1;
      S.accueillir.cards.done[n] = true;
      writeState(S);
      refreshCardsDone();
      alert("‚úÖ Carte " + n + " valid√©e.");
    }

    function markAsDoneLater(){
      alert("Ok. Reviens valider quand tu as fait l‚Äôaction flash üôÇ");
    }

    // ----------------- MIROIR PRO -----------------
    function wireMirror(){
      // multi select self (max 3)
      const selfBox = document.getElementById("selfCards");
      if(selfBox){
        selfBox.addEventListener("click", (e)=>{
          const el = e.target.closest(".opt"); if(!el) return;
          const v = el.getAttribute("data-v");
          const cur = S.accueillir.miroir.self || [];

          if(el.dataset.on === "1"){
            el.dataset.on = "0";
            S.accueillir.miroir.self = cur.filter(x=>x!==v);
          }else{
            if(cur.length >= 3){
              const first = cur[0];
              const firstEl = selfBox.querySelector(`.opt[data-v="${first}"]`);
              if(firstEl) firstEl.dataset.on = "0";
              S.accueillir.miroir.self = cur.slice(1);
            }
            el.dataset.on = "1";
            S.accueillir.miroir.self = [...S.accueillir.miroir.self, v];
          }

          writeState(S);
          renderSelfPickInfo();
          renderMirror();
        });
      }

      wireScenePick("scene1","s1");
      wireScenePick("scene2","s2");
      wireScenePick("scene3","s3");
    }

    function wireScenePick(boxId, key){
      const box = document.getElementById(boxId);
      if(!box) return;
      box.addEventListener("click",(e)=>{
        const el=e.target.closest(".opt"); if(!el) return;
        [...box.querySelectorAll(".opt")].forEach(x=>x.dataset.on="0");
        el.dataset.on="1";
        S.accueillir.miroir[key] = el.getAttribute("data-v");
        writeState(S);
        renderMirror();
      });
    }

    function renderSelfPickInfo(){
      const info = document.getElementById("selfPickInfo");
      const picks = S.accueillir.miroir.self || [];
      if(!info) return;
      if(picks.length === 0){
        info.style.display = "none";
        return;
      }
      info.style.display = "block";
      info.innerHTML = "<strong>Tu veux renvoyer :</strong> " + picks.map(labelFr).join(" ‚Ä¢ ") + (picks.length<3 ? "<br><em>Encore " + (3-picks.length) + " choix</em>" : "");
    }

    function perceivedFromScenes(s1,s2,s3){
      const tags = [];

      // Sc√®ne 1 (rituels)
      if(s1==="rituel"){ tags.push("ouvert","fiable"); }
      if(s1==="faible"){ tags.push("timide","ferm√©"); }
      if(s1==="tel"){ tags.push("distant","d√©sengag√©"); }
      if(s1==="trop_familier"){ tags.push("sympa","risque"); }

      // Sc√®ne 2 (r√©ciprocit√©)
      if(s2==="question_active"){ tags.push("respect","curieux"); }
      if(s2==="subit"){ tags.push("passif","timide"); }
      if(s2==="sec"){ tags.push("tendu"); }
      if(s2==="trop_efface"){ tags.push("invisible","passif"); }

      // Sc√®ne 3 (place)
      if(s3==="prise_parole"){ tags.push("place","ouvert"); }
      if(s3==="silence"){ tags.push("invisible","ferm√©"); }
      if(s3==="valide"){ tags.push("place","coop"); }
      if(s3==="ironique"){ tags.push("risque","distant"); }

      return [...new Set(tags)];
    }

    function labelFr(tag){
      const m = {
        fiable:"fiable",
        calme:"calme",
        ouvert:"ouvert",
        respect:"digne / respectueux",
        curieux:"curieux",
        place:"je prends ma place",
        coop:"je renforce le collectif",

        timide:"timide",
        ferm√©:"ferm√©",
        distant:"distant",
        d√©sengag√©:"d√©sengag√©",
        sympa:"sympa",
        risque:"trop familier / risqu√©",
        passif:"passif",
        tendu:"tendu",
        invisible:"invisible"
      };
      return m[tag] || tag;
    }

    function renderMirror(){
      const box = document.getElementById("mirrorBox");
      if(!box) return;

      const self = S.accueillir.miroir.self || [];
      const s1 = S.accueillir.miroir.s1;
      const s2 = S.accueillir.miroir.s2;
      const s3 = S.accueillir.miroir.s3;

      if(self.length<3 || !s1 || !s2 || !s3){
        box.style.display="none";
        return;
      }

      const perceived = perceivedFromScenes(s1,s2,s3);
      const selfLabels = self.map(labelFr);
      const perceivedLabels = perceived.map(labelFr);

      const gap1 = self.filter(x=>!perceived.includes(x)).map(labelFr);
      const gap2 = perceived.filter(x=>!self.includes(x)).map(labelFr);

      S.accueillir.miroir.result = { self, perceived };
      writeState(S);

      box.style.display="block";
      box.innerHTML = `
        <div><strong>Image que tu veux donner :</strong> ${selfLabels.join(" ‚Ä¢ ")}</div>
        <div style="margin-top:6px;"><strong>Image renvoy√©e par tes choix :</strong> ${perceivedLabels.join(" ‚Ä¢ ")}</div>
        <div style="margin-top:10px;">
          <strong>Le miroir (√©cart) :</strong><br>
          ‚Ä¢ <em>Tu veux montrer mais on ne le voit pas assez</em> : ${gap1.length?gap1.join(" ‚Ä¢ "):"‚Äî"}<br>
          ‚Ä¢ <em>On peut croire (sans vouloir)</em> : ${gap2.length?gap2.join(" ‚Ä¢ "):"‚Äî"}
        </div>
        <div style="margin-top:10px;"><strong>Objectif :</strong> choisis 1 micro-ajustement pour recoller √† l‚Äôimage voulue.</div>
      `;
      setProgress();
    }

    function autoSuggestMirror(){
      document.getElementById("mirrorAction").value =
        "√Ä chaque rencontre : Regard (calme) ‚Üí Pr√©nom (moi + lui) ‚Üí 1 question ouverte (Comment/Quoi).";
    }

    function saveMirror(){
      const action = document.getElementById("mirrorAction").value.trim();
      if(!action){ alert("√âcris 1 ajustement concret (1 phrase), puis enregistre."); return; }
      S.accueillir.miroir.action = action;
      S.profile.ajustementAccueil = action;
      writeState(S);
      setProgress();
      alert("‚úÖ Miroir enregistr√©.");
    }

    // ----------------- FIN PILIER -----------------
    function finishAccueillir(){
      const cardsOk = Object.values(S.accueillir.cards.done).every(Boolean);
      const mirrorOk = !!(S.accueillir.miroir && S.accueillir.miroir.action && S.accueillir.miroir.action.trim());

      if(!cardsOk){ alert("Il te manque au moins une carte √† valider (7/7)."); return; }
      if(!mirrorOk){ alert("Il te manque ton micro-ajustement dans le Miroir Pro."); return; }

      S.done.accueillir = true;
      S.badges.relieur = true;
      writeState(S);

      setProgress();
      alert("‚úÖ Badge RELIEUR activ√© !");
      window.location.href="./synthese.html";
    }

    // ----------------- RESTORE UI -----------------
    function restoreUI(){
      // restore selected card and done count
      const cur = S.accueillir.cards.current || 1;
      showCard(cur);
      refreshCardsDone();

      // restore mirror self
      const ms = S.accueillir.miroir || {};
      if(ms.self){
        ms.self.forEach(v=>{
          const el = document.querySelector(`#selfCards .opt[data-v="${v}"]`);
          if(el) el.dataset.on="1";
        });
        renderSelfPickInfo();
      }

      // restore scenes
      const map = { s1:"scene1", s2:"scene2", s3:"scene3" };
      Object.keys(map).forEach(k=>{
        const val = ms[k];
        if(!val) return;
        const el = document.querySelector(`#${map[k]} .opt[data-v="${val}"]`);
        if(el) el.dataset.on="1";
      });

      if(ms.action) document.getElementById("mirrorAction").value = ms.action;
      renderMirror();
      setProgress();
    }

    window.addEventListener('load', function() {
      if (typeof lucide !== 'undefined') lucide.createIcons();

      // click cards
      document.getElementById("cards7")?.addEventListener("click",(e)=>{
        const el = e.target.closest(".opt"); if(!el) return;
        const n = parseInt(el.getAttribute("data-card"),10);
        if(!n) return;
        showCard(n);
      });

      wireMirror();
      restoreUI();
    });
  </script>
</body>
</html>
