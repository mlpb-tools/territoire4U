<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Plateforme p√©dagogique Iparralde 2040 - Mission Locale Pays Basque">
    <meta name="theme-color" content="#C62828">
    <title>Comp√©tence Territoire ‚Äì Iparralde 2040 x LS4YOU</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSXBhcnJhbGRlIDIwNDAiLCJzaG9ydF9uYW1lIjoiSXBhcnJhbGRlIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNGRkZGRkYiLCJ0aGVtZV9jb2xvciI6IiNDNjI4MjgiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l4T1RJaUlHaGxhV2RvZEQwaU1Ua3lJajQ4Y21WamRDQjNhV1IwYUQwaU1Ua3lJaUJvWldsbmFIUTlJakU1TWlJZ1ptbHNiRDBpSTBNMk1qZ3lPQ0l2UGp3dmMzWm5QZz09Iiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700;900&family=Nunito:wght@300;400;600;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --rouge-cerise: #C62828;
            --jaune-vif: #FFD54F;
            --turquoise: #4DD0E1;
            --menthe: #B2DFDB;
            --orange: #FFB74D;
            --blanc: #FFFFFF;
            --noir: #212121;
            --gris-leger: #F5F5F5;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 16px;
            font-weight: 400;
            line-height: 1.7;
            color: var(--noir);
            background: var(--blanc);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* TYPOGRAPHIE */
        h1, h2, h3 {
            font-family: 'Nunito', sans-serif;
            font-weight: 900;
            line-height: 1.2;
        }

        h1 {
            font-size: clamp(36px, 6vw, 64px);
            color: var(--rouge-cerise);
            letter-spacing: -0.02em;
        }

        h2 {
            font-size: clamp(28px, 5vw, 48px);
            color: var(--rouge-cerise);
        }

        h3 {
            font-size: clamp(20px, 4vw, 32px);
            color: var(--noir);
            font-weight: 800;
        }

        p {
            font-weight: 300;
            font-size: clamp(15px, 2vw, 18px);
        }

        /* CONTENEUR PRINCIPAL */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* HEADER */
        .header {
            background: var(--blanc);
            padding: 24px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(198, 40, 40, 0.08);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-family: 'Nunito', sans-serif;
            font-weight: 900;
            font-size: clamp(24px, 4vw, 36px);
            color: var(--rouge-cerise);
            letter-spacing: -0.01em;
        }

        .logo span {
            color: var(--turquoise);
        }

        .nav-breadcrumb {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            font-weight: 500;
            color: var(--noir);
        }

        /* BOUTONS */
        .btn {
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            padding: 16px 40px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 18px;
            display: inline-block;
            text-decoration: none;
            text-align: center;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--rouge-cerise), #D32F2F);
            color: var(--blanc);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(198, 40, 40, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--turquoise), #26C6DA);
            color: var(--blanc);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(77, 208, 225, 0.3);
        }

        .btn-outline {
            background: var(--blanc);
            color: var(--rouge-cerise);
            border: 3px solid var(--rouge-cerise);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: var(--rouge-cerise);
            color: var(--blanc);
        }

        /* CARDS */
        .card {
            background: var(--blanc);
            border-radius: 32px;
            padding: 40px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.06);
            transition: var(--transition);
            margin-bottom: 30px;
            position: relative;
            overflow: visible;
        }

        .card::before {
            content: '';
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--turquoise);
            opacity: 0.1;
            top: -30px;
            right: -30px;
            z-index: 0;
        }

        .card > * {
            position: relative;
            z-index: 1;
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        /* PILLAR CARDS */
        .pillar-card {
            cursor: pointer;
            border-radius: 32px;
            position: relative;
            overflow: hidden;
            border: 4px solid transparent;
        }

        .pillar-card::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            top: -50px;
            right: -50px;
            opacity: 0.15;
            transition: var(--transition);
        }

        .pillar-card.accueillir {
            border-color: var(--rouge-cerise);
        }

        .pillar-card.accueillir::after {
            background: var(--rouge-cerise);
        }

        .pillar-card.creer {
            border-color: var(--jaune-vif);
        }

        .pillar-card.creer::after {
            background: var(--jaune-vif);
        }

        .pillar-card.habiter {
            border-color: var(--turquoise);
        }

        .pillar-card.habiter::after {
            background: var(--turquoise);
        }

        .pillar-card.soin {
            border-color: var(--orange);
        }

        .pillar-card.soin::after {
            background: var(--orange);
        }

        .pillar-card:hover::after {
            opacity: 0.25;
            transform: scale(1.2);
        }

        /* BADGES */
        .badge {
            display: inline-block;
            padding: 12px 28px;
            border-radius: 50px;
            background: linear-gradient(135deg, var(--jaune-vif), var(--orange));
            color: var(--noir);
            font-weight: 700;
            font-size: 16px;
            margin: 8px;
            box-shadow: 0 6px 20px rgba(255, 213, 79, 0.4);
            font-family: 'Nunito', sans-serif;
        }

        .badge-earned {
            padding: 32px;
            border-radius: 32px;
            background: linear-gradient(135deg, var(--rouge-cerise), var(--orange));
            color: var(--blanc);
            text-align: center;
            min-width: 220px;
            box-shadow: 0 12px 40px rgba(198, 40, 40, 0.3);
        }

        .badge-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* PROGRESS BAR */
        .progress-bar {
            width: 100%;
            height: 16px;
            background: var(--gris-leger);
            border-radius: 50px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--turquoise), var(--menthe));
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50px;
            box-shadow: 0 2px 12px rgba(77, 208, 225, 0.5);
        }

        /* GRID */
        .grid {
            display: grid;
            gap: 30px;
            margin: 30px 0;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        }

        /* CHOICE CARDS */
        .choice-card {
            padding: 24px;
            border: 3px solid var(--gris-leger);
            border-radius: 24px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--blanc);
            position: relative;
        }

        .choice-card::before {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--turquoise);
            opacity: 0;
            top: -15px;
            right: -15px;
            transition: var(--transition);
        }

        .choice-card:hover {
            border-color: var(--turquoise);
            transform: scale(1.03);
        }

        .choice-card:hover::before {
            opacity: 0.15;
        }

        .choice-card.selected {
            border-color: var(--rouge-cerise);
            background: linear-gradient(135deg, rgba(198, 40, 40, 0.05), rgba(255, 183, 77, 0.05));
            box-shadow: 0 8px 24px rgba(198, 40, 40, 0.2);
        }

        .choice-card.selected::before {
            background: var(--rouge-cerise);
            opacity: 0.2;
        }

        /* INPUTS */
        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 16px 24px;
            border: 3px solid var(--gris-leger);
            border-radius: 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            transition: var(--transition);
            background: var(--blanc);
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--turquoise);
            box-shadow: 0 0 0 4px rgba(77, 208, 225, 0.15);
        }

        textarea {
            min-height: 140px;
            resize: vertical;
        }

        /* SCORE DISPLAY */
        .score-display {
            background: linear-gradient(135deg, var(--turquoise), var(--menthe));
            color: var(--blanc);
            padding: 48px;
            border-radius: 32px;
            text-align: center;
            margin: 30px 0;
            box-shadow: 0 16px 48px rgba(77, 208, 225, 0.3);
        }

        .score-number {
            font-size: clamp(56px, 8vw, 80px);
            font-weight: 900;
            font-family: 'Nunito', sans-serif;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* VERBS */
        .verb-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            margin: 30px 0;
        }

        .verb-card {
            padding: 24px;
            text-align: center;
            border: 3px solid var(--gris-leger);
            border-radius: 24px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--blanc);
        }

        .verb-card:hover {
            transform: scale(1.08) rotate(2deg);
            border-color: var(--jaune-vif);
        }

        .verb-card.selected {
            border-color: var(--rouge-cerise);
            background: linear-gradient(135deg, var(--jaune-vif), var(--orange));
            color: var(--blanc);
            box-shadow: 0 8px 24px rgba(255, 213, 79, 0.4);
        }

        .verb-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        /* SLIDER */
        .slider-container {
            margin: 30px 0;
        }

        input[type="range"] {
            width: 100%;
            height: 12px;
            border-radius: 12px;
            background: var(--gris-leger);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--rouge-cerise), var(--orange));
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--rouge-cerise), var(--orange));
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
        }

        /* CANVAS */
        .canvas-container {
            background: var(--gris-leger);
            border-radius: 24px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: inset 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        #mindmapCanvas {
            border: 3px dashed var(--turquoise);
            border-radius: 16px;
            cursor: crosshair;
            background: var(--blanc);
        }

        /* SIMULATOR RESULT */
        .simulator-result {
            padding: 32px;
            border-radius: 24px;
            margin: 30px 0;
            border-left: 8px solid;
        }

        .simulator-result.vert {
            background: linear-gradient(135deg, rgba(77, 208, 225, 0.1), rgba(178, 223, 219, 0.1));
            border-left-color: var(--turquoise);
        }

        .simulator-result.orange {
            background: linear-gradient(135deg, rgba(255, 183, 77, 0.1), rgba(255, 213, 79, 0.1));
            border-left-color: var(--orange);
        }

        .simulator-result.rouge {
            background: linear-gradient(135deg, rgba(198, 40, 40, 0.1), rgba(211, 47, 47, 0.1));
            border-left-color: var(--rouge-cerise);
        }

        /* DRAG DROP */
        .drag-drop-area {
            min-height: 200px;
            border: 3px dashed var(--turquoise);
            border-radius: 24px;
            padding: 24px;
            margin: 20px 0;
            background: var(--gris-leger);
        }

        .draggable {
            padding: 16px 24px;
            background: var(--blanc);
            border: 3px solid var(--turquoise);
            border-radius: 20px;
            margin: 12px 0;
            cursor: move;
            user-select: none;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .draggable:hover {
            border-color: var(--rouge-cerise);
            transform: scale(1.02);
        }

        /* TREE */
        .tree-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin: 40px 0;
        }

        .tree-section {
            width: 100%;
            max-width: 600px;
        }

        /* BADGES COLLECTION */
        .badges-collection {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            justify-content: center;
            margin: 40px 0;
        }

        /* PASSPORT */
        .passport-section {
            background: var(--blanc);
            padding: 60px 40px;
            border-radius: 32px;
            margin: 30px 0;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .passport-section::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: var(--turquoise);
            opacity: 0.05;
            top: -100px;
            right: -100px;
        }

        .passport-section::after {
            content: '';
            position: absolute;
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: var(--jaune-vif);
            opacity: 0.05;
            bottom: -80px;
            left: -80px;
        }

        /* FEEDBACK DISPLAY */
        .feedback-display {
            background: linear-gradient(135deg, rgba(77, 208, 225, 0.1), rgba(178, 223, 219, 0.1));
            border-left: 6px solid var(--turquoise);
            padding: 24px;
            border-radius: 20px;
            margin: 16px 0;
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 100px;
            right: 30px;
            padding: 20px 32px;
            background: var(--blanc);
            border-radius: 50px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.4s ease;
            font-weight: 600;
            border-left: 6px solid var(--rouge-cerise);
        }

        @keyframes slideIn {
            from { transform: translateX(500px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 60px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid var(--gris-leger);
            border-top-color: var(--rouge-cerise);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* UTILITIES */
        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* DECORATIVE ELEMENTS */
        .floating-circle {
            position: fixed;
            border-radius: 50%;
            opacity: 0.08;
            pointer-events: none;
            z-index: -1;
        }

        .circle-1 {
            width: 400px;
            height: 400px;
            background: var(--turquoise);
            top: 10%;
            right: -100px;
        }

        .circle-2 {
            width: 300px;
            height: 300px;
            background: var(--jaune-vif);
            bottom: 15%;
            left: -80px;
        }

        .circle-3 {
            width: 200px;
            height: 200px;
            background: var(--orange);
            top: 50%;
            right: 10%;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }

            .card {
                padding: 24px;
                border-radius: 24px;
            }

            .btn {
                padding: 14px 32px;
                width: 100%;
                margin: 8px 0;
            }

            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }

            .verb-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .score-display {
                padding: 32px 24px;
            }

            .passport-section {
                padding: 40px 24px;
            }

            h1 {
                font-size: 36px;
            }

            h2 {
                font-size: 28px;
            }
        }

        /* PRINT STYLES */
        @media print {
            .header, .btn, .notification {
                display: none;
            }

            .passport-section {
                box-shadow: none;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Decorative floating circles -->
    <div class="floating-circle circle-1"></div>
    <div class="floating-circle circle-2"></div>
    <div class="floating-circle circle-3"></div>

    <header class="header">
        <div class="header-content">
            <div class="logo">Iparralde <span>2040</span></div>
            <div class="nav-breadcrumb">
                <span id="breadcrumb">Accueil</span>
            </div>
            <button class="btn btn-outline" onclick="showProgress()">üìä Ma Progression</button>
        </div>
    </header>

    <div class="container">
        <div id="app-content"></div>
    </div>

    <script>
        // ==================== SERVICE WORKER ====================
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKCkgPT4gc2VsZi5za2lwV2FpdGluZygpKTsKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHsKICBldmVudC5yZXNwb25kV2l0aCgKICAgIGNhY2hlcy5tYXRjaChldmVudC5yZXF1ZXN0KS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlIHx8IGZldGNoKGV2ZW50LnJlcXVlc3QpKQogICk7Cn0pOw==');
        }

        // ==================== STATE MANAGEMENT ====================
        const AppState = {
            currentView: 'accueil',
            userData: {},
            badges: [],
            progress: {
                accueillir: 0,
                creer: 0,
                habiter: 0,
                soin: 0
            },
            load() {
                const saved = localStorage.getItem('iparralde2040');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.userData = data.userData || {};
                    this.badges = data.badges || [];
                    this.progress = data.progress || this.progress;
                }
            },
            save() {
                localStorage.setItem('iparralde2040', JSON.stringify({
                    userData: this.userData,
                    badges: this.badges,
                    progress: this.progress
                }));
            },
            addBadge(name) {
                if (!this.badges.includes(name)) {
                    this.badges.push(name);
                    this.save();
                    showNotification(`üéâ Badge "${name}" d√©bloqu√© !`);
                }
            },
            updateProgress(pillar, percent) {
                this.progress[pillar] = Math.max(this.progress[pillar], percent);
                this.save();
            }
        };

        // ==================== ROUTER ====================
        function navigate(view) {
            window.location.hash = view;
        }

        function handleRoute() {
            const hash = window.location.hash.slice(1) || 'accueil';
            AppState.currentView = hash;
            updateBreadcrumb(hash);
            renderView(hash);
        }

        function updateBreadcrumb(view) {
            const breadcrumb = document.getElementById('breadcrumb');
            const labels = {
                'accueil': 'Accueil',
                'accueillir': 'Accueillir',
                'accueillir-a': 'Accueillir ‚Üí Image de soi',
                'accueillir-b': 'Accueillir ‚Üí Feedback',
                'creer': 'Cr√©er',
                'creer-a': 'Cr√©er ‚Üí Mon meilleur',
                'creer-b': 'Cr√©er ‚Üí Switch posture',
                'habiter': 'Habiter',
                'habiter-a': 'Habiter ‚Üí Mindmap',
                'habiter-b': 'Habiter ‚Üí Simulateur',
                'soin': 'Prendre soin',
                'soin-a': 'Soin ‚Üí Arbre r√©silience',
                'soin-b': 'Soin ‚Üí R√©seau soutien',
                'synthese': 'Mon Passeport'
            };
            breadcrumb.textContent = labels[view] || 'Navigation';
        }

        // ==================== VIEWS ====================
        function renderView(view) {
            const content = document.getElementById('app-content');
            content.className = 'fade-in';

            switch(view) {
                case 'accueil':
                    renderAccueil();
                    break;
                case 'accueillir':
                    renderPillarIntro('accueillir');
                    break;
                case 'accueillir-a':
                    renderAccueillirA();
                    break;
                case 'accueillir-b':
                    renderAccueillirB();
                    break;
                case 'creer':
                    renderPillarIntro('creer');
                    break;
                case 'creer-a':
                    renderCreerA();
                    break;
                case 'creer-b':
                    renderCreerB();
                    break;
                case 'habiter':
                    renderPillarIntro('habiter');
                    break;
                case 'habiter-a':
                    renderHabiterA();
                    break;
                case 'habiter-b':
                    renderHabiterB();
                    break;
                case 'soin':
                    renderPillarIntro('soin');
                    break;
                case 'soin-a':
                    renderSoinA();
                    break;
                case 'soin-b':
                    renderSoinB();
                    break;
                case 'synthese':
                    renderSynthese();
                    break;
                default:
                    renderAccueil();
            }
        }

        function renderAccueil() {
            const content = document.getElementById('app-content');
            content.innerHTML = `
                <div style="text-align: center; margin: 60px 0;">
                    <h1>üåç Bienvenue dans Iparralde 2040</h1>
                    <p style="font-size: 20px; color: #757575; max-width: 700px; margin: 30px auto; font-weight: 300;">
                        Explore ton territoire, d√©veloppe tes comp√©tences et construis ton avenir au Pays Basque.
                    </p>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${calculateGlobalProgress()}%"></div>
                </div>
                <p style="text-align: center; margin-bottom: 50px; font-size: 18px; font-weight: 600;">Progression globale : ${calculateGlobalProgress()}%</p>

                <div class="grid grid-2">
                    <div class="card pillar-card accueillir" onclick="navigate('accueillir')">
                        <h2>ü§ù ACCUEILLIR</h2>
                        <p style="margin: 20px 0;">D√©couvre ton style relationnel et apprends √† recevoir les feedbacks.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.accueillir}%"></div>
                        </div>
                        <p style="margin-top: 12px; font-size: 15px; font-weight: 600; color: #757575;">
                            ${AppState.progress.accueillir}% compl√©t√©
                        </p>
                    </div>

                    <div class="card pillar-card creer" onclick="navigate('creer')">
                        <h2>‚ú® CR√âER</h2>
                        <p style="margin: 20px 0;">Identifie tes forces et transforme ta posture professionnelle.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.creer}%"></div>
                        </div>
                        <p style="margin-top: 12px; font-size: 15px; font-weight: 600; color: #757575;">
                            ${AppState.progress.creer}% compl√©t√©
                        </p>
                    </div>

                    <div class="card pillar-card habiter" onclick="navigate('habiter')">
                        <h2>üè° HABITER</h2>
                        <p style="margin: 20px 0;">Cartographie tes ressources et simule ton budget de vie.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.habiter}%"></div>
                        </div>
                        <p style="margin-top: 12px; font-size: 15px; font-weight: 600; color: #757575;">
                            ${AppState.progress.habiter}% compl√©t√©
                        </p>
                    </div>

                    <div class="card pillar-card soin" onclick="navigate('soin')">
                        <h2>üíö PRENDRE SOIN</h2>
                        <p style="margin: 20px 0;">Construis ton arbre de r√©silience et ton r√©seau de soutien.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.soin}%"></div>
                        </div>
                        <p style="margin-top: 12px; font-size: 15px; font-weight: 600; color: #757575;">
                            ${AppState.progress.soin}% compl√©t√©
                        </p>
                    </div>
                </div>

                ${AppState.badges.length > 0 ? `
                    <div class="card" style="margin-top: 50px; text-align: center;">
                        <h3>üèÜ Mes Badges</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 16px; justify-content: center; margin-top: 24px;">
                            ${AppState.badges.map(b => `<span class="badge">${b}</span>`).join('')}
                        </div>
                    </div>
                ` : ''}

                <div style="text-align: center; margin-top: 60px;">
                    <button class="btn btn-primary" onclick="navigate('synthese')">
                        üìã Voir Mon Passeport Comp√©tences
                    </button>
                </div>
            `;
        }

        function renderPillarIntro(pillar) {
            const content = document.getElementById('app-content');
            const data = {
                accueillir: {
                    title: 'ü§ù ACCUEILLIR',
                    desc: 'Comment je me pr√©sente et comment je re√ßois les retours des autres ?',
                    activities: [
                        { id: 'a', title: 'Image de soi/publique', desc: 'Explore ton style relationnel en groupe et en situation professionnelle' },
                        { id: 'b', title: 'Le feedback comme don', desc: 'Apprends √† recevoir et utiliser les retours constructifs' }
                    ]
                },
                creer: {
                    title: '‚ú® CR√âER',
                    desc: 'Quelles sont mes forces et comment je les valorise ?',
                    activities: [
                        { id: 'a', title: 'Moi √† mon meilleur', desc: 'Identifie tes comp√©tences √† travers tes r√©ussites' },
                        { id: 'b', title: 'Switch posture', desc: 'Passe de demandeur √† offreur sur le march√© du travail' }
                    ]
                },
                habiter: {
                    title: 'üè° HABITER',
                    desc: 'De quoi j\'ai besoin pour vivre ici et maintenant ?',
                    activities: [
                        { id: 'a', title: 'Fais le point', desc: 'Cartographie tes ressources, obstacles et alli√©s' },
                        { id: 'b', title: 'Simulateur Vraie Vie', desc: 'Teste ton budget et ta strat√©gie financi√®re' }
                    ]
                },
                soin: {
                    title: 'üíö PRENDRE SOIN',
                    desc: 'Comment je cultive mon bien-√™tre et ma r√©silience ?',
                    activities: [
                        { id: 'a', title: 'Arbre de r√©silience', desc: 'Construis tes fondations, ton tronc et tes branches' },
                        { id: 'b', title: 'R√©seau + Stressom√®tre', desc: 'Identifie tes soutiens et mesure ton stress' }
                    ]
                }
            };

            const info = data[pillar];
            content.innerHTML = `
                <div class="card" style="text-align: center;">
                    <h1>${info.title}</h1>
                    <p style="font-size: 20px; margin: 30px 0; font-weight: 300;">${info.desc}</p>
                </div>

                <div class="grid grid-2">
                    ${info.activities.map(act => `
                        <div class="card" style="cursor: pointer;" onclick="navigate('${pillar}-${act.id}')">
                            <h3>Activit√© ${act.id.toUpperCase()} : ${act.title}</h3>
                            <p style="margin: 20px 0;">${act.desc}</p>
                            <button class="btn btn-primary" style="margin-top: 20px;">
                                Commencer ‚Üí
                            </button>
                        </div>
                    `).join('')}
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-outline" onclick="navigate('accueil')">
                        ‚Üê Retour √† l'accueil
                    </button>
                </div>
            `;
        }

        // ==================== ACCUEILLIR A ====================
        function renderAccueillirA() {
            if (!AppState.userData.accueillirA) {
                AppState.userData.accueillirA = { step: 1, choices: [], scores: {} };
            }

            const data = AppState.userData.accueillirA;
            const content = document.getElementById('app-content');

            if (data.step === 1) {
                content.innerHTML = `
                    <div class="card">
                        <h2>üé≠ Image de soi/publique</h2>
                        <p style="margin: 20px 0;">Quand tu arrives dans un nouveau groupe, comment te comportes-tu naturellement ?</p>
                        <p style="font-size: 15px; color: #757575; font-weight: 500;">Choisis 3 comportements qui te ressemblent</p>
                    </div>

                    <div class="grid grid-3" id="choiceGrid">
                        ${['Observer d\'abord', 'Parler rapidement', 'Sourire et saluer', 'Rester en retrait', 'Poser des questions', '√âcouter attentivement'].map((choice, i) => `
                            <div class="choice-card" onclick="toggleChoice(${i}, '${choice}')">
                                <p style="font-weight: 600;">${choice}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="nextStepAccueillirA()" id="nextBtn" disabled>
                            Continuer ‚Üí
                        </button>
                    </div>
                `;
            } else if (data.step === 2) {
                content.innerHTML = `
                    <div class="card">
                        <h2>üéØ Simulations professionnelles</h2>
                        <p style="margin: 20px 0;">Voici 3 situations. Choisis la r√©action qui te correspond le mieux.</p>
                    </div>

                    <div class="card">
                        <h3>Situation 1 : Entretien d'embauche</h3>
                        <p style="margin: 16px 0;">Le recruteur te demande "Parlez-moi de vous". Tu r√©ponds :</p>
                        <div class="grid grid-2">
                            <div class="choice-card" onclick="selectSimulation(0, 0)">
                                <p>Je liste mes dipl√¥mes et exp√©riences de mani√®re factuelle</p>
                            </div>
                            <div class="choice-card" onclick="selectSimulation(0, 1)">
                                <p>Je raconte un parcours avec mes motivations et valeurs</p>
                            </div>
                            <div class="choice-card" onclick="selectSimulation(0, 2)">
                                <p>Je pose des questions sur le poste avant de r√©pondre</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Situation 2 : Premier jour de travail</h3>
                        <p style="margin: 16px 0;">Tu arrives dans l'√©quipe. Quelle est ta priorit√© ?</p>
                        <div class="grid grid-2">
                            <div class="choice-card" onclick="selectSimulation(1, 0)">
                                <p>Apprendre les proc√©dures et comprendre mon r√¥le</p>
                            </div>
                            <div class="choice-card" onclick="selectSimulation(1, 1)">
                                <p>Rencontrer chaque personne et cr√©er du lien</p>
                            </div>
                            <div class="choice-card" onclick="selectSimulation(1, 2)">
                                <p>Observer le fonctionnement avant d'intervenir</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Situation 3 : Accueil d'un client m√©content</h3>
                        <p style="margin: 16px 0;">Un client arrive √©nerv√©. Tu d√©cides de :</p>
                        <div class="grid grid-2">
                            <div class="choice-card" onclick="selectSimulation(2, 0)">
                                <p>L'√©couter calmement et reformuler son probl√®me</p>
                            </div>
                            <div class="choice-card" onclick="selectSimulation(2, 1)">
                                <p>Proposer imm√©diatement une solution</p>
                            </div>
                            <div class="choice-card" onclick="selectSimulation(2, 2)">
                                <p>M'excuser et appeler un responsable</p>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="calculateScoresA()" id="calcBtn" disabled>
                            Voir mes r√©sultats
                        </button>
                    </div>
                `;
            } else if (data.step === 3) {
                content.innerHTML = `
                    <div class="score-display">
                        <h2 style="color: white; margin-bottom: 30px;">üìä Ton profil relationnel</h2>
                        <div class="grid grid-3">
                            <div>
                                <p style="font-size: 16px; opacity: 0.9; margin-bottom: 8px;">Ouverture</p>
                                <div class="score-number">${data.scores.ouverture || 0}%</div>
                            </div>
                            <div>
                                <p style="font-size: 16px; opacity: 0.9; margin-bottom: 8px;">Clart√©</p>
                                <div class="score-number">${data.scores.clarte || 0}%</div>
                            </div>
                            <div>
                                <p style="font-size: 16px; opacity: 0.9; margin-bottom: 8px;">Confiance</p>
                                <div class="score-number">${data.scores.confiance || 0}%</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>üí° Ton ajustement pour demain</h3>
                        <p style="margin: 20px 0;">Quelle petite action peux-tu faire d√®s demain pour am√©liorer ton image professionnelle ?</p>
                        <textarea id="ajustement" placeholder="Exemple : Sourire davantage lors des pr√©sentations, poser une question d'ouverture...">${data.ajustement || ''}</textarea>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="finishAccueillirA()">
                            Valider et continuer
                        </button>
                    </div>
                `;
            }
        }

        let selectedChoices = [];
        function toggleChoice(index, text) {
            const cards = document.querySelectorAll('.choice-card');
            const card = cards[index];

            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                selectedChoices = selectedChoices.filter(c => c !== text);
            } else {
                if (selectedChoices.length < 3) {
                    card.classList.add('selected');
                    selectedChoices.push(text);
                }
            }

            document.getElementById('nextBtn').disabled = selectedChoices.length !== 3;
        }

        function nextStepAccueillirA() {
            AppState.userData.accueillirA.choices = selectedChoices;
            AppState.userData.accueillirA.step = 2;
            AppState.save();
            renderAccueillirA();
        }

        let simulations = [null, null, null];
        function selectSimulation(sitIndex, choice) {
            const cards = document.querySelectorAll('.card')[sitIndex + 1].querySelectorAll('.choice-card');
            cards.forEach((c, i) => {
                c.classList.toggle('selected', i === choice);
            });
            simulations[sitIndex] = choice;

            document.getElementById('calcBtn').disabled = simulations.includes(null);
        }

        function calculateScoresA() {
            const scores = {
                ouverture: Math.floor(Math.random() * 30) + 60,
                clarte: Math.floor(Math.random() * 30) + 60,
                confiance: Math.floor(Math.random() * 30) + 60
            };
            AppState.userData.accueillirA.scores = scores;
            AppState.userData.accueillirA.simulations = simulations;
            AppState.userData.accueillirA.step = 3;
            AppState.save();
            renderAccueillirA();
        }

        function finishAccueillirA() {
            const ajustement = document.getElementById('ajustement').value;
            AppState.userData.accueillirA.ajustement = ajustement;
            AppState.updateProgress('accueillir', 50);
            AppState.save();
            navigate('accueillir-b');
        }

        // ==================== ACCUEILLIR B ====================
        function renderAccueillirB() {
            if (!AppState.userData.accueillirB) {
                AppState.userData.accueillirB = { step: 1 };
            }

            const data = AppState.userData.accueillirB;
            const content = document.getElementById('app-content');

            if (data.step === 1) {
                content.innerHTML = `
                    <div class="card">
                        <h2>üéÅ Le feedback comme don</h2>
                        <p style="margin: 20px 0;">Apprends √† recevoir les retours comme des cadeaux pour progresser</p>
                    </div>

                    <div class="card">
                        <h3>üìö Les 3 √©tapes du feedback r√©ussi</h3>
                        <div style="margin: 30px 0;">
                            <div class="feedback-display">
                                <h4 style="margin-bottom: 8px;">1Ô∏è‚É£ √âcouter activement</h4>
                                <p>Laisse la personne s'exprimer compl√®tement, sans l'interrompre ni te justifier imm√©diatement.</p>
                            </div>
                            <div class="feedback-display">
                                <h4 style="margin-bottom: 8px;">2Ô∏è‚É£ Reformuler pour comprendre</h4>
                                <p>"Si je comprends bien, tu me dis que..." - V√©rifie que tu as bien saisi le message.</p>
                            </div>
                            <div class="feedback-display">
                                <h4 style="margin-bottom: 8px;">3Ô∏è‚É£ Agir ou remercier</h4>
                                <p>Identifie une action concr√®te OU remercie sinc√®rement pour l'information.</p>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="startFeedbackGame()">
                            Commencer le jeu dialogue ‚Üí
                        </button>
                    </div>
                `;
            } else if (data.step === 2) {
                content.innerHTML = `
                    <div class="card">
                        <h2>üéÆ Jeu dialogue : Re√ßois un feedback</h2>
                        <p style="margin: 20px 0;"><strong>Situation :</strong> Ton responsable te dit "J'ai remarqu√© que tu arrives souvent en retard le matin"</p>
                    </div>

                    <div class="card">
                        <h3>√âtape 1 : Comment r√©agis-tu imm√©diatement ?</h3>
                        <div class="grid grid-2" style="margin-top: 20px;">
                            <div class="choice-card" onclick="selectFeedbackChoice(1, 0)">
                                <p>‚ùå "C'est √† cause des bus qui sont en retard"</p>
                            </div>
                            <div class="choice-card" onclick="selectFeedbackChoice(1, 1)">
                                <p>‚úÖ "Je t'√©coute, peux-tu m'en dire plus ?"</p>
                            </div>
                            <div class="choice-card" onclick="selectFeedbackChoice(1, 2)">
                                <p>‚ùå "Je ne suis pas d'accord, je suis √† l'heure"</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>√âtape 2 : Reformule le message</h3>
                        <div class="grid grid-2" style="margin-top: 20px;">
                            <div class="choice-card" onclick="selectFeedbackChoice(2, 0)">
                                <p>‚úÖ "Tu as constat√© que j'arrivais en retard plusieurs fois"</p>
                            </div>
                            <div class="choice-card" onclick="selectFeedbackChoice(2, 1)">
                                <p>‚ùå "Tu penses que je ne suis pas professionnel"</p>
                            </div>
                            <div class="choice-card" onclick="selectFeedbackChoice(2, 2)">
                                <p>‚ùå "C'est juste 5 minutes, ce n'est pas grave"</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>√âtape 3 : Quelle action proposes-tu ?</h3>
                        <div class="grid grid-2" style="margin-top: 20px;">
                            <div class="choice-card" onclick="selectFeedbackChoice(3, 0)">
                                <p>‚úÖ "Je vais partir 15 minutes plus t√¥t pour anticiper"</p>
                            </div>
                            <div class="choice-card" onclick="selectFeedbackChoice(3, 1)">
                                <p>‚ùå "Je vais essayer de faire mieux"</p>
                            </div>
                            <div class="choice-card" onclick="selectFeedbackChoice(3, 2)">
                                <p>‚úÖ "Merci de me l'avoir dit, je vais ajuster mon organisation"</p>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="calculateFeedbackScore()" id="feedbackBtn" disabled>
                            Voir mon score
                        </button>
                    </div>
                `;
            } else if (data.step === 3) {
                content.innerHTML = `
                    <div class="score-display">
                        <h2 style="color: white; margin-bottom: 20px;">üéØ Score de r√©ception du feedback</h2>
                        <div class="score-number">${data.score || 0}%</div>
                        <p style="margin-top: 20px; font-size: 18px;">
                            ${data.score >= 80 ? 'üåü Excellent ! Tu ma√Ætrises l\'art du feedback constructif' :
                              data.score >= 50 ? 'üëç Bien ! Tu as compris les bases, continue √† pratiquer' :
                              'üí™ Continue tes efforts, chaque feedback est une opportunit√©'}
                        </p>
                    </div>

                    <div class="card">
                        <h3>üìù Ma r√©flexion personnelle</h3>
                        <p style="margin: 20px 0;"><strong>Un feedback que j'accepte de recevoir :</strong></p>
                        <textarea id="feedbackAccepte" placeholder="Exemple : Sur ma ponctualit√©, ma communication...">${data.feedbackAccepte || ''}</textarea>

                        <p style="margin: 30px 0 20px;"><strong>Ma r√©ponse ouverte pour le prochain feedback :</strong></p>
                        <textarea id="reponseOuverte" placeholder="Exemple : Merci de me partager cela, comment puis-je m'am√©liorer concr√®tement ?">${data.reponseOuverte || ''}</textarea>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="finishAccueillirB()">
                            Terminer le module ACCUEILLIR
                        </button>
                    </div>
                `;
            }
        }

        function startFeedbackGame() {
            AppState.userData.accueillirB.step = 2;
            AppState.save();
            renderAccueillirB();
        }

        let feedbackChoices = [null, null, null];
        function selectFeedbackChoice(step, choice) {
            const cards = document.querySelectorAll('.card')[step].querySelectorAll('.choice-card');
            cards.forEach((c, i) => {
                c.classList.toggle('selected', i === choice);
            });
            feedbackChoices[step - 1] = choice;

            document.getElementById('feedbackBtn').disabled = feedbackChoices.includes(null);
        }

        function calculateFeedbackScore() {
            const correctAnswers = [1, 0, 0];
            let score = 0;
            feedbackChoices.forEach((choice, i) => {
                if (choice === correctAnswers[i]) score += 33;
            });
            score = Math.min(100, score);

            AppState.userData.accueillirB.score = score;
            AppState.userData.accueillirB.choices = feedbackChoices;
            AppState.userData.accueillirB.step = 3;
            AppState.save();
            renderAccueillirB();
        }

        function finishAccueillirB() {
            AppState.userData.accueillirB.feedbackAccepte = document.getElementById('feedbackAccepte').value;
            AppState.userData.accueillirB.reponseOuverte = document.getElementById('reponseOuverte').value;
            AppState.updateProgress('accueillir', 100);
            AppState.addBadge('RELIEUR ü§ù');
            AppState.save();
            navigate('accueil');
        }

        // ==================== CR√âER A ====================
        function renderCreerA() {
            if (!AppState.userData.creerA) {
                AppState.userData.creerA = { step: 1 };
            }

            const data = AppState.userData.creerA;
            const content = document.getElementById('app-content');

            if (data.step === 1) {
                content.innerHTML = `
                    <div class="card">
                        <h2>‚≠ê Moi √† mon meilleur</h2>
                        <p style="margin: 20px 0;">Raconte une situation o√π tu as √©t√© fier¬∑e de toi, o√π tu t'es senti¬∑e comp√©tent¬∑e et utile</p>
                    </div>

                    <div class="card">
                        <h3>üìñ Ton r√©cit de r√©ussite</h3>
                        <textarea id="recitReussite" placeholder="D√©cris la situation : qu'as-tu fait ? Comment ? Quel a √©t√© le r√©sultat ?" style="min-height: 160px; margin-top: 20px;">${data.recit || ''}</textarea>

                        <p style="margin: 30px 0 12px;"><strong>Dans quel contexte ?</strong></p>
                        <select id="contexte">
                            <option value="">-- Choisis un contexte --</option>
                            <option value="famille" ${data.contexte === 'famille' ? 'selected' : ''}>En famille</option>
                            <option value="quartier" ${data.contexte === 'quartier' ? 'selected' : ''}>Dans mon quartier</option>
                            <option value="travail" ${data.contexte === 'travail' ? 'selected' : ''}>Au travail</option>
                            <option value="ecole" ${data.contexte === 'ecole' ? 'selected' : ''}>√Ä l'√©cole/formation</option>
                            <option value="association" ${data.contexte === 'association' ? 'selected' : ''}>En association</option>
                            <option value="loisirs" ${data.contexte === 'loisirs' ? 'selected' : ''}>Dans mes loisirs</option>
                        </select>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="nextStepCreerA()">
                            Identifier mes comp√©tences ‚Üí
                        </button>
                    </div>
                `;
            } else if (data.step === 2) {
                const verbes = [
                    { icon: 'üîß', text: 'Organiser' },
                    { icon: 'üõ†Ô∏è', text: 'R√©parer' },
                    { icon: 'ü§ù', text: 'Relier' },
                    { icon: 'üí°', text: 'Innover' },
                    { icon: 'üéØ', text: 'Planifier' },
                    { icon: 'üó£Ô∏è', text: 'Communiquer' },
                    { icon: 'üë•', text: 'Animer' },
                    { icon: 'üìä', text: 'Analyser' },
                    { icon: 'üé®', text: 'Cr√©er' },
                    { icon: '‚úçÔ∏è', text: 'R√©diger' },
                    { icon: 'üîç', text: 'Chercher' },
                    { icon: 'üéì', text: 'Transmettre' },
                    { icon: 'üí™', text: 'Pers√©v√©rer' },
                    { icon: '‚ö°', text: 'R√©agir' },
                    { icon: 'üåü', text: 'Motiver' }
                ];

                content.innerHTML = `
                    <div class="card">
                        <h2>üéØ Identifie tes comp√©tences</h2>
                        <p style="margin: 20px 0;">S√©lectionne au minimum 3 verbes qui d√©crivent ce que tu as fait dans ton r√©cit</p>
                        <p style="font-size: 16px; font-weight: 600; color: var(--turquoise);">${selectedVerbs.length}/3 minimum</p>
                    </div>

                    <div class="verb-grid">
                        ${verbes.map((v, i) => `
                            <div class="verb-card" onclick="toggleVerb(${i}, '${v.text}')">
                                <div class="verb-icon">${v.icon}</div>
                                <p style="font-weight: 600; margin-top: 8px;">${v.text}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="generateSkillsCloud()" id="verbBtn" disabled>
                            G√©n√©rer mon nuage de comp√©tences
                        </button>
                    </div>
                `;
            } else if (data.step === 3) {
                content.innerHTML = `
                    <div class="card">
                        <h2>‚òÅÔ∏è Mon nuage de comp√©tences</h2>
                        <div style="background: linear-gradient(135deg, var(--menthe), var(--turquoise)); padding: 50px; border-radius: 24px; text-align: center; margin-top: 30px;">
                            ${data.competences.map((c, i) => {
                                const sizes = ['36px', '32px', '28px', '32px', '36px'];
                                const colors = ['var(--rouge-cerise)', 'var(--orange)', 'var(--jaune-vif)', 'white', 'var(--noir)'];
                                return `<span style="font-size: ${sizes[i % 5]}; color: ${colors[i % 5]}; margin: 16px; display: inline-block; font-weight: 800; font-family: 'Nunito', sans-serif;">${c}</span>`;
                            }).join('')}
                        </div>
                    </div>

                    <div class="card">
                        <h3>üíº Valorise tes comp√©tences</h3>
                        <p style="margin: 20px 0;">Dans quel m√©tier ou projet pourrais-tu utiliser ces comp√©tences ?</p>
                        <textarea id="valorisation" placeholder="Exemple : Dans l'animation sociale, le commerce, l'artisanat...">${data.valorisation || ''}</textarea>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="finishCreerA()">
                            Valider et continuer
                        </button>
                    </div>
                `;
            }
        }

        let selectedVerbs = [];
        function toggleVerb(index, text) {
            const cards = document.querySelectorAll('.verb-card');
            const card = cards[index];

            if (card.classList.contains('selected')) {
                card.classList.remove('selected');
                selectedVerbs = selectedVerbs.filter(v => v !== text);
            } else {
                card.classList.add('selected');
                selectedVerbs.push(text);
            }

            const btn = document.getElementById('verbBtn');
            if (btn) btn.disabled = selectedVerbs.length < 3;
        }

        function nextStepCreerA() {
            const recit = document.getElementById('recitReussite').value;
            const contexte = document.getElementById('contexte').value;

            if (!recit || !contexte) {
                showNotification('‚ö†Ô∏è Merci de compl√©ter tous les champs');
                return;
            }

            AppState.userData.creerA.recit = recit;
            AppState.userData.creerA.contexte = contexte;
            AppState.userData.creerA.step = 2;
            AppState.save();
            renderCreerA();
        }

        function generateSkillsCloud() {
            AppState.userData.creerA.competences = selectedVerbs;
            AppState.userData.creerA.step = 3;
            AppState.save();
            renderCreerA();
        }

        function finishCreerA() {
            const valorisation = document.getElementById('valorisation').value;
            AppState.userData.creerA.valorisation = valorisation;
            AppState.updateProgress('creer', 50);
            AppState.save();
            navigate('creer-b');
        }

        // ==================== CR√âER B ====================
        function renderCreerB() {
            if (!AppState.userData.creerB) {
                AppState.userData.creerB = { step: 1, switched: [] };
            }

            const data = AppState.userData.creerB;
            const content = document.getElementById('app-content');

            if (data.step === 1) {
                content.innerHTML = `
                    <div class="card">
                        <h2>üîÑ Switch posture : De demandeur √† offreur</h2>
                        <p style="margin: 20px 0;">Transforme ta mani√®re de te pr√©senter sur le march√© du travail</p>
                    </div>

                    <div class="card">
                        <h3>üìä Exercice de reformulation</h3>
                        <p style="margin: 20px 0;">Glisse les phrases de gauche (posture demandeur) vers la droite (posture offreur)</p>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
                            <div>
                                <h4 style="color: var(--rouge-cerise); margin-bottom: 16px;">‚ùå Posture Demandeur</h4>
                                <div id="demandeur" class="drag-drop-area" ondrop="drop(event)" ondragover="allowDrop(event)">
                                    ${data.switched.length === 0 ? `
                                        <div class="draggable" draggable="true" ondragstart="drag(event)" id="drag1">
                                            Je cherche un emploi
                                        </div>
                                        <div class="draggable" draggable="true" ondragstart="drag(event)" id="drag2">
                                            J'ai besoin de formation
                                        </div>
                                        <div class="draggable" draggable="true" ondragstart="drag(event)" id="drag3">
                                            Je voudrais travailler ici
                                        </div>
                                        <div class="draggable" draggable="true" ondragstart="drag(event)" id="drag4">
                                            Je suis disponible imm√©diatement
                                        </div>
                                    ` : '<p style="color: var(--turquoise); font-weight: 700;">‚úÖ Tout transform√© !</p>'}
                                </div>
                            </div>

                            <div>
                                <h4 style="color: var(--turquoise); margin-bottom: 16px;">‚úÖ Posture Offreur</h4>
                                <div id="offreur" class="drag-drop-area" ondrop="drop(event)" ondragover="allowDrop(event)">
                                    ${data.switched.map(s => `<div class="draggable" style="border-color: var(--turquoise);">${s}</div>`).join('')}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="nextStepCreerB()" ${data.switched.length < 4 ? 'disabled' : ''}>
                            Continuer vers les sc√©narios ‚Üí
                        </button>
                    </div>
                `;
            } else if (data.step === 2) {
                content.innerHTML = `
                    <div class="card">
                        <h2>üé¨ 4 mini-sc√©narios locaux</h2>
                        <p style="margin: 20px 0;">Comment formulerais-tu ta pr√©sentation dans ces situations au Pays Basque ?</p>
                    </div>

                    <div class="card">
                        <h3>Sc√©nario 1 : Au march√© de Bayonne</h3>
                        <p style="margin: 16px 0;">Un commer√ßant cherche de l'aide pour les samedis. Tu lui dis :</p>
                        <textarea id="scenario1" placeholder="Exemple : Je suis dynamique et j'ai l'habitude du contact client...">${data.scenario1 || ''}</textarea>
                    </div>

                    <div class="card">
                        <h3>Sc√©nario 2 : Dans une ferme √† Cambo</h3>
                        <p style="margin: 16px 0;">Un agriculteur parle d'agro-tourisme. Tu proposes :</p>
                        <textarea id="scenario2" placeholder="Exemple : Je peux vous aider √† d√©velopper l'accueil, j'aime le travail en ext√©rieur...">${data.scenario2 || ''}</textarea>
                    </div>

                    <div class="card">
                        <h3>Sc√©nario 3 : √Ä la Cit√© de l'Oc√©an</h3>
                        <p style="margin: 16px 0;">Ils recrutent des m√©diateurs. Tu mets en avant :</p>
                        <textarea id="scenario3" placeholder="Exemple : J'ai de l'exp√©rience en animation et je parle basque...">${data.scenario3 || ''}</textarea>
                    </div>

                    <div class="card">
                        <h3>Sc√©nario 4 : Aupr√®s d'une entreprise de surf √† Biarritz</h3>
                        <p style="margin: 16px 0;">Tu postules comme moniteur/vendeur. Tu √©cris :</p>
                        <textarea id="scenario4" placeholder="Exemple : Je pratique le surf depuis 5 ans et je sais cr√©er une ambiance conviviale...">${data.scenario4 || ''}</textarea>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="finishCreerB()">
                            Terminer le module CR√âER
                        </button>
                    </div>
                `;
            }
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);

            if (ev.target.id === 'offreur' || ev.target.classList.contains('drag-drop-area')) {
                const offreur = document.getElementById('offreur');
                const transformations = {
                    'drag1': 'Je propose mes comp√©tences en...',
                    'drag2': 'Je souhaite d√©velopper mes savoir-faire',
                    'drag3': 'Je peux apporter √† votre √©quipe...',
                    'drag4': 'Je suis pr√™t¬∑e √† m\'investir d√®s maintenant'
                };

                const newText = transformations[data] || draggedElement.textContent;
                AppState.userData.creerB.switched.push(newText);
                draggedElement.remove();
                AppState.save();
                renderCreerB();
            }
        }

        function nextStepCreerB() {
            AppState.userData.creerB.step = 2;
            AppState.save();
            renderCreerB();
        }

        function finishCreerB() {
            AppState.userData.creerB.scenario1 = document.getElementById('scenario1').value;
            AppState.userData.creerB.scenario2 = document.getElementById('scenario2').value;
            AppState.userData.creerB.scenario3 = document.getElementById('scenario3').value;
            AppState.userData.creerB.scenario4 = document.getElementById('scenario4').value;
            AppState.updateProgress('creer', 100);
            AppState.addBadge('CR√âATEUR ‚ú®');
            AppState.save();
            navigate('accueil');
        }

        // ==================== HABITER A ====================
        function renderHabiterA() {
            const content = document.getElementById('app-content');
            content.innerHTML = `
                <div class="card">
                    <h2>üó∫Ô∏è Fais le point : Ta carte mentale</h2>
                    <p style="margin: 20px 0;">Cartographie tes ressources, obstacles et alli√©s pour habiter au Pays Basque</p>
                </div>

                <div class="canvas-container">
                    <canvas id="mindmapCanvas" width="800" height="600"></canvas>
                </div>

                <div class="card">
                    <h3>üé® Instructions</h3>
                    <p style="margin: 12px 0;">1. Clique sur une branche pour ajouter un n≈ìud</p>
                    <p style="margin: 12px 0;">2. Double-clique sur un n≈ìud pour le modifier</p>
                    <p style="margin: 12px 0;">3. Ajoute maximum 5 n≈ìuds par branche</p>

                    <div class="grid grid-3" style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="addNode('ressources')">
                            + Ressources
                        </button>
                        <button class="btn btn-secondary" onclick="addNode('obstacles')">
                            + Obstacles
                        </button>
                        <button class="btn btn-primary" onclick="addNode('allies')">
                            + Alli√©s
                        </button>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-secondary" onclick="saveMindmap()">
                        üíæ Sauvegarder ma carte
                    </button>
                    <button class="btn btn-primary" onclick="finishHabiterA()">
                        Continuer ‚Üí
                    </button>
                </div>
            `;

            initMindmap();
        }

        let mindmapData = { ressources: [], obstacles: [], allies: [] };
        let canvas, ctx;

        function initMindmap() {
            canvas = document.getElementById('mindmapCanvas');
            if (!canvas) return;

            ctx = canvas.getContext('2d');

            const container = canvas.parentElement;
            canvas.width = Math.min(800, container.clientWidth - 60);
            canvas.height = 600;

            drawMindmap();
        }

        function drawMindmap() {
            if (!ctx) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            ctx.fillStyle = '#C62828';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 50, 0, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = 'white';
            ctx.font = 'bold 18px Nunito';
            ctx.textAlign = 'center';
            ctx.fillText('MOI', centerX, centerY + 6);

            const branches = [
                { name: 'Ressources', angle: -Math.PI / 2, color: '#4DD0E1', nodes: mindmapData.ressources },
                { name: 'Obstacles', angle: Math.PI / 6, color: '#C62828', nodes: mindmapData.obstacles },
                { name: 'Alli√©s', angle: 5 * Math.PI / 6, color: '#FFB74D', nodes: mindmapData.allies }
            ];

            branches.forEach(branch => {
                const branchX = centerX + Math.cos(branch.angle) * 180;
                const branchY = centerY + Math.sin(branch.angle) * 180;

                ctx.strokeStyle = branch.color;
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(branchX, branchY);
                ctx.stroke();

                ctx.fillStyle = branch.color;
                ctx.beginPath();
                ctx.arc(branchX, branchY, 40, 0, 2 * Math.PI);
                ctx.fill();

                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Nunito';
                ctx.fillText(branch.name, branchX, branchY + 5);

                branch.nodes.forEach((node, i) => {
                    const nodeAngle = branch.angle + (i - branch.nodes.length / 2) * 0.4;
                    const nodeX = branchX + Math.cos(nodeAngle) * 120;
                    const nodeY = branchY + Math.sin(nodeAngle) * 120;

                    ctx.strokeStyle = branch.color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(branchX, branchY);
                    ctx.lineTo(nodeX, nodeY);
                    ctx.stroke();

                    ctx.fillStyle = 'white';
                    ctx.strokeStyle = branch.color;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(nodeX, nodeY, 28, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();

                    ctx.fillStyle = branch.color;
                    ctx.font = '12px Nunito';
                    ctx.fillText(node.name.substring(0, 10), nodeX, nodeY + 4);
                });
            });
        }

        function addNode(branch) {
            const branchData = mindmapData[branch];
            if (branchData.length >= 5) {
                showNotification('‚ö†Ô∏è Maximum 5 n≈ìuds par branche');
                return;
            }

            const name = prompt(`Nom du n≈ìud (${branch}) :`);
            if (!name) return;

            const priority = prompt('Priorit√© (1-3) :', '2');

            branchData.push({ name, priority: parseInt(priority) || 2 });
            drawMindmap();
        }

        function saveMindmap() {
            AppState.userData.habiterA = { mindmap: mindmapData };
            AppState.save();
            showNotification('üíæ Carte mentale sauvegard√©e');
        }

        function finishHabiterA() {
            saveMindmap();
            AppState.updateProgress('habiter', 50);
            navigate('habiter-b');
        }

        // ==================== HABITER B ====================
        function renderHabiterB() {
            if (!AppState.userData.habiterB) {
                AppState.userData.habiterB = { step: 1 };
            }

            const data = AppState.userData.habiterB;
            const content = document.getElementById('app-content');

            if (data.step === 1) {
                content.innerHTML = `
                    <div class="card">
                        <h2>üí∞ Simulateur Vraie Vie</h2>
                        <p style="margin: 20px 0;">Teste ton projet de vie au Pays Basque</p>
                    </div>

                    <div class="card">
                        <h3>üìä Tes param√®tres</h3>

                        <p style="margin: 30px 0 12px;"><strong>Type d'emploi :</strong></p>
                        <select id="jobType">
                            <option value="smic">SMIC (temps plein)</option>
                            <option value="partiel">Mi-temps</option>
                            <option value="apprenti">Apprenti</option>
                            <option value="interim">Int√©rim</option>
                        </select>

                        <p style="margin: 30px 0 12px;"><strong>Salaire brut mensuel (‚Ç¨) :</strong></p>
                        <input type="number" id="salaire" value="1800" min="500">

                        <p style="margin: 30px 0 12px;"><strong>Type d'habitat :</strong></p>
                        <select id="habitat">
                            <option value="studio">Studio (450-600‚Ç¨)</option>
                            <option value="t2">T2 (600-800‚Ç¨)</option>
                            <option value="coloc">Colocation (350-500‚Ç¨)</option>
                            <option value="chez_parents">Chez mes parents</option>
                        </select>

                        <p style="margin: 30px 0 12px;"><strong>Mobilit√© :</strong></p>
                        <select id="mobilite">
                            <option value="voiture">Voiture personnelle</option>
                            <option value="transport">Transports en commun</option>
                            <option value="velo">V√©lo/marche</option>
                        </select>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="calculateBudget()">
                            Calculer mon budget NET
                        </button>
                    </div>
                `;
            } else if (data.step === 2) {
                content.innerHTML = `
                    <div class="score-display">
                        <h2 style="color: white; margin-bottom: 20px;">üíµ Ton budget mensuel</h2>
                        <div class="score-number">${data.net}‚Ç¨</div>
                        <p style="margin-top: 12px; font-size: 18px;">Net mensuel apr√®s cotisations</p>
                    </div>

                    <div class="card">
                        <h3>üìã R√©partition estim√©e</h3>
                        <div style="margin: 30px 0; font-size: 18px;">
                            <p style="margin: 16px 0;">üè† Logement : <strong>${data.logement}‚Ç¨</strong></p>
                            <p style="margin: 16px 0;">üöó Transport : <strong>${data.transport}‚Ç¨</strong></p>
                            <p style="margin: 16px 0;">üçΩÔ∏è Alimentation : <strong>${data.alimentation}‚Ç¨</strong></p>
                            <p style="margin: 16px 0;">üì± Abonnements : <strong>${data.abonnements}‚Ç¨</strong></p>
                            <p style="margin: 16px 0; font-size: 20px; color: var(--rouge-cerise);">üí∞ Reste √† vivre : <strong>${data.reste}‚Ç¨</strong></p>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="launchImprevu()">
                            Lancer les impr√©vus ‚Üí
                        </button>
                    </div>
                `;
            } else if (data.step === 3) {
                content.innerHTML = `
                    <div class="card">
                        <h2>‚ö° Impr√©vus de la vraie vie</h2>
                        <p style="margin: 20px 0;">Tu vas faire face √† 3 situations impr√©vues. Choisis ta strat√©gie √† chaque fois.</p>
                    </div>

                    <div class="card">
                        <h3>Impr√©vu 1 : ${data.imprevus[0].titre}</h3>
                        <p style="margin: 16px 0;">${data.imprevus[0].desc}</p>
                        <div class="grid grid-2" style="margin-top: 20px;">
                            ${data.imprevus[0].choix.map((c, i) => `
                                <div class="choice-card" onclick="selectStrategy(0, ${i})">
                                    <p>${c}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="card">
                        <h3>Impr√©vu 2 : ${data.imprevus[1].titre}</h3>
                        <p style="margin: 16px 0;">${data.imprevus[1].desc}</p>
                        <div class="grid grid-2" style="margin-top: 20px;">
                            ${data.imprevus[1].choix.map((c, i) => `
                                <div class="choice-card" onclick="selectStrategy(1, ${i})">
                                    <p>${c}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="card">
                        <h3>Impr√©vu 3 : ${data.imprevus[2].titre}</h3>
                        <p style="margin: 16px 0;">${data.imprevus[2].desc}</p>
                        <div class="grid grid-2" style="margin-top: 20px;">
                            ${data.imprevus[2].choix.map((c, i) => `
                                <div class="choice-card" onclick="selectStrategy(2, ${i})">
                                    <p>${c}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="calculateViability()" id="viabBtn" disabled>
                            Voir le diagnostic de viabilit√©
                        </button>
                    </div>
                `;
            } else if (data.step === 4) {
                const viability = data.viability;
                const color = viability === 'vert' ? 'vert' : viability === 'orange' ? 'orange' : 'rouge';

                content.innerHTML = `
                    <div class="simulator-result ${color}">
                        <h2>üéØ Diagnostic de viabilit√©</h2>
                        <h3 style="margin-top: 24px; font-size: 36px; font-family: 'Nunito', sans-serif;">
                            ${viability === 'vert' ? '‚úÖ Viable' : viability === 'orange' ? '‚ö†Ô∏è Fragile' : '‚ùå Risqu√©'}
                        </h3>
                        <p style="margin-top: 24px; font-size: 18px;">
                            ${viability === 'vert' ? 'Ton projet est √©quilibr√©. Tu as des marges pour faire face aux impr√©vus.' :
                              viability === 'orange' ? 'Ton projet tient mais attention aux impr√©vus. Pense √† constituer une √©pargne de pr√©caution.' :
                              'Ton projet pr√©sente des risques financiers importants. Revisite tes choix ou cherche des aides.'}
                        </p>
                    </div>

                    <div class="card">
                        <h3>üí° Recommandations</h3>
                        <ul style="margin: 24px 0; padding-left: 32px; font-size: 17px; line-height: 2;">
                            ${data.recommandations.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>

                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-primary" onclick="finishHabiterB()">
                            Terminer le module HABITER
                        </button>
                    </div>
                `;
            }
        }

        function calculateBudget() {
            const salaireBrut = parseInt(document.getElementById('salaire').value);
            const habitat = document.getElementById('habitat').value;
            const mobilite = document.getElementById('mobilite').value;

            const net = Math.round(salaireBrut * 0.78);

            const logements  = {
'studio': 525,
't2': 700,
'coloc': 425,
'chez_parents': 100
};
        const transports = {
            'voiture': 250,
            'transport': 50,
            'velo': 20
        };

        const logement = logements[habitat];
        const transport = transports[mobilite];
        const alimentation = 250;
        const abonnements = 80;
        const reste = net - logement - transport - alimentation - abonnements;

        AppState.userData.habiterB = {
            step: 2,
            net,
            logement,
            transport,
            alimentation,
            abonnements,
            reste
        };

        AppState.save();
        renderHabiterB();
    }

    function launchImprevu() {
        const imprevus = [
            {
                titre: 'R√©paration voiture',
                desc: 'Ta voiture tombe en panne, 400‚Ç¨ de r√©paration',
                choix: [
                    'Puiser dans mes √©conomies',
                    'Demander un pr√™t familial',
                    'Repousser la r√©paration et prendre les transports'
                ]
            },
            {
                titre: 'Invitation mariage',
                desc: 'Un ami se marie dans 2 mois (cadeau + frais)',
                choix: [
                    'Participer pleinement (200‚Ç¨)',
                    'Cadeau symbolique uniquement',
                    'D√©cliner poliment'
                ]
            },
            {
                titre: 'Opportunit√© formation',
                desc: 'Formation qualifiante (500‚Ç¨) qui peut booster ta carri√®re',
                choix: [
                    'M\'inscrire et √©taler les paiements',
                    'Chercher un financement CPF/P√¥le Emploi',
                    'Renoncer pour l\'instant'
                ]
            }
        ];

        AppState.userData.habiterB.step = 3;
        AppState.userData.habiterB.imprevus = imprevus;
        AppState.userData.habiterB.strategies = [null, null, null];
        AppState.save();
        renderHabiterB();
    }

    function selectStrategy(imprevuIndex, choiceIndex) {
        const cards = document.querySelectorAll('.card')[imprevuIndex + 1].querySelectorAll('.choice-card');
        cards.forEach((c, i) => {
            c.classList.toggle('selected', i === choiceIndex);
        });

        AppState.userData.habiterB.strategies[imprevuIndex] = choiceIndex;
        AppState.save();

        const strategies = AppState.userData.habiterB.strategies;
        document.getElementById('viabBtn').disabled = strategies.includes(null);
    }

    function calculateViability() {
        const reste = AppState.userData.habiterB.reste;
        const strategies = AppState.userData.habiterB.strategies;

        let score = 0;
        if (reste > 300) score += 50;
        else if (reste > 150) score += 30;
        else if (reste > 0) score += 10;

        strategies.forEach((s, i) => {
            if (s === 1 || s === 2) score += 15;
        });

        let viability, recommandations;
        if (score >= 70) {
            viability = 'vert';
            recommandations = [
                'Constitue une √©pargne de pr√©caution (3 mois de loyer)',
                'Profite de ta stabilit√© pour te former',
                'Anticipe tes projets (permis, √©quipement...)'
            ];
        } else if (score >= 40) {
            viability = 'orange';
            recommandations = [
                'Optimise tes d√©penses courantes',
                'Cherche des aides (APL, transport, CAF)',
                'Cr√©e un budget pr√©visionnel mensuel'
            ];
        } else {
            viability = 'rouge';
            recommandations = [
                'Rencontre un conseiller Mission Locale pour revoir ton projet',
                'Explore les aides financi√®res disponibles',
                'Envisage une colocation ou retour familial temporaire'
            ];
        }

        AppState.userData.habiterB.step = 4;
        AppState.userData.habiterB.viability = viability;
        AppState.userData.habiterB.recommandations = recommandations;
        AppState.save();
        renderHabiterB();
    }

    function finishHabiterB() {
        AppState.updateProgress('habiter', 100);
        AppState.addBadge('ANCR√â üè°');
        AppState.save();
        navigate('accueil');
    }

    // ==================== SOIN A ====================
    function renderSoinA() {
        if (!AppState.userData.soinA) {
            AppState.userData.soinA = { racines: [], tronc: [], branches: [], diagnostics: {} };
        }

        const content = document.getElementById('app-content');
        content.innerHTML = `
            <div class="card">
                <h2>üå≥ Arbre de r√©silience</h2>
                <p style="margin: 20px 0;">Construis ton arbre en ajoutant tes racines, ton tronc et tes branches</p>
            </div>

            <div class="tree-container">
                <div class="tree-section">
                    <h3>üåø Branches (3 max)</h3>
                    <p style="font-size: 15px; color: #757575; margin: 12px 0;">Mes projets, mes r√™ves</p>
                    <div id="branchesZone" class="drag-drop-area" ondrop="dropTree(event, 'branches')" ondragover="allowDrop(event)">
                        ${AppState.userData.soinA.branches.map(b => `<div class="draggable">${b}</div>`).join('')}
                    </div>
                    <input type="text" id="brancheInput" placeholder="Ajouter une branche" style="margin-top: 12px;">
                    <button class="btn btn-primary" style="margin-top: 12px;" onclick="addTreeElement('branches')">
                        + Ajouter
                    </button>
                </div>

                <div class="tree-section">
                    <h3>ü™µ Tronc (2 max)</h3>
                    <p style="font-size: 15px; color: #757575; margin: 12px 0;">Mes valeurs, mes forces</p>
                    <div id="troncZone" class="drag-drop-area" ondrop="dropTree(event, 'tronc')" ondragover="allowDrop(event)">
                        ${AppState.userData.soinA.tronc.map(t => `<div class="draggable">${t}</div>`).join('')}
                    </div>
                    <input type="text" id="troncInput" placeholder="Ajouter au tronc" style="margin-top: 12px;">
                    <button class="btn btn-primary" style="margin-top: 12px;" onclick="addTreeElement('tronc')">
                        + Ajouter
                    </button>
                </div>

                <div class="tree-section">
                    <h3>üå± Racines (3 max)</h3>
                    <p style="font-size: 15px; color: #757575; margin: 12px 0;">Mes soutiens, mes ressources</p>
                    <div id="racinesZone" class="drag-drop-area" ondrop="dropTree(event, 'racines')" ondragover="allowDrop(event)">
                        ${AppState.userData.soinA.racines.map(r => `<div class="draggable">${r}</div>`).join('')}
                    </div>
                    <input type="text" id="racinesInput" placeholder="Ajouter une racine" style="margin-top: 12px;">
                    <button class="btn btn-primary" style="margin-top: 12px;" onclick="addTreeElement('racines')">
                        + Ajouter
                    </button>
                </div>
            </div>

            <div class="card">
                <h3>üéöÔ∏è Auto-diagnostic (1-4)</h3>
                <div class="slider-container">
                    <label style="font-weight: 600;">Confiance en l'avenir</label>
                    <input type="range" min="1" max="4" value="${AppState.userData.soinA.diagnostics.confiance || 2}" 
                           oninput="updateDiagnostic('confiance', this.value)">
                    <span id="confianceVal" style="font-size: 20px; font-weight: 700; color: var(--turquoise);">${AppState.userData.soinA.diagnostics.confiance || 2}/4</span>
                </div>

                <div class="slider-container">
                    <label style="font-weight: 600;">Capacit√© √† rebondir</label>
                    <input type="range" min="1" max="4" value="${AppState.userData.soinA.diagnostics.rebondir || 2}"
                           oninput="updateDiagnostic('rebondir', this.value)">
                    <span id="rebondirVal" style="font-size: 20px; font-weight: 700; color: var(--turquoise);">${AppState.userData.soinA.diagnostics.rebondir || 2}/4</span>
                </div>

                <div class="slider-container">
                    <label style="font-weight: 600;">Soutien social</label>
                    <input type="range" min="1" max="4" value="${AppState.userData.soinA.diagnostics.soutien || 2}"
                           oninput="updateDiagnostic('soutien', this.value)">
                    <span id="soutienVal" style="font-size: 20px; font-weight: 700; color: var(--turquoise);">${AppState.userData.soinA.diagnostics.soutien || 2}/4</span>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-primary" onclick="finishSoinA()">
                    Valider mon arbre ‚Üí
                </button>
            </div>
        `;
    }

    function addTreeElement(type) {
        const input = document.getElementById(`${type}Input`);
        const value = input.value.trim();

        if (!value) {
            showNotification('‚ö†Ô∏è Merci d\'entrer un texte');
            return;
        }

        const max = type === 'tronc' ? 2 : 3;
        if (AppState.userData.soinA[type].length >= max) {
            showNotification(`‚ö†Ô∏è Maximum ${max} √©l√©ments`);
            return;
        }

        AppState.userData.soinA[type].push(value);
        AppState.save();
        input.value = '';
        renderSoinA();
    }

    function dropTree(ev, zone) {
        ev.preventDefault();
    }

    function updateDiagnostic(type, value) {
        AppState.userData.soinA.diagnostics[type] = parseInt(value);
        document.getElementById(`${type}Val`).textContent = `${value}/4`;
        AppState.save();
    }

    function finishSoinA() {
        AppState.updateProgress('soin', 50);
        AppState.save();
        navigate('soin-b');
    }

    // ==================== SOIN B ====================
    function renderSoinB() {
        if (!AppState.userData.soinB) {
            AppState.userData.soinB = {
                reseau: {
                    famille: [],
                    amis: [],
                    pro: [],
                    sante: [],
                    loisirs: []
                },
                stress: 2
            };
        }

        const content = document.getElementById('app-content');
        content.innerHTML = `
            <div class="card">
                <h2>ü§ù Mon r√©seau de soutien</h2>
                <p style="margin: 20px 0;">Identifie les personnes sur qui tu peux compter dans 5 cat√©gories</p>
            </div>

            ${['famille', 'amis', 'pro', 'sante', 'loisirs'].map(cat => {
                const labels = {
                    famille: 'üë®‚Äçüë©‚Äçüëß Famille',
                    amis: 'üë• Amis proches',
                    pro: 'üíº R√©seau professionnel',
                    sante: '‚öïÔ∏è Sant√© & bien-√™tre',
                    loisirs: 'üé® Loisirs & passions'
                };

                return `
                    <div class="card">
                        <h3>${labels[cat]}</h3>
                        <div id="${cat}List" style="margin: 20px 0;">
                            ${AppState.userData.soinB.reseau[cat].map(p => `
                                <div style="padding: 12px 20px; background: var(--gris-leger); border-radius: 16px; margin: 8px 0; border-left: 4px solid var(--turquoise);">
                                    <strong>${p.nom}</strong> - Confiance: ${p.confiance}/5
                                </div>
                            `).join('')}
                        </div>
                        <input type="text" id="${cat}Nom" placeholder="Nom de la personne" style="margin-top: 16px;">
                        <input type="number" id="${cat}Confiance" placeholder="Niveau confiance (1-5)" min="1" max="5" style="margin-top: 12px;">
                        <button class="btn btn-primary" style="margin-top: 12px;" onclick="addContact('${cat}')">
                            + Ajouter
                        </button>
                    </div>
                `;
            }).join('')}

            <div class="card">
                <h3>üìä Stressom√®tre</h3>
                <p style="margin: 20px 0;">Comment √©values-tu ton niveau de stress actuel ?</p>
                <div class="slider-container">
                    <input type="range" min="1" max="10" value="${AppState.userData.soinB.stress}"
                           oninput="updateStress(this.value)">
                    <div style="text-align: center; margin-top: 20px;">
                        <span style="font-size: 48px; font-weight: 900; font-family: 'Nunito', sans-serif; color: ${getStressColor(AppState.userData.soinB.stress)};">
                            ${AppState.userData.soinB.stress}/10
                        </span>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-primary" onclick="finishSoinB()">
                    Terminer le module PRENDRE SOIN
                </button>
            </div>
        `;
    }

    function addContact(category) {
        const nom = document.getElementById(`${category}Nom`).value.trim();
        const confiance = parseInt(document.getElementById(`${category}Confiance`).value);

        if (!nom || !confiance || confiance < 1 || confiance > 5) {
            showNotification('‚ö†Ô∏è Merci de remplir tous les champs correctement');
            return;
        }

        AppState.userData.soinB.reseau[category].push({ nom, confiance });
        AppState.save();
        renderSoinB();
    }

    function updateStress(value) {
        AppState.userData.soinB.stress = parseInt(value);
        AppState.save();
    }

    function getStressColor(stress) {
        if (stress <= 3) return '#4DD0E1';
        if (stress <= 6) return '#FFB74D';
        return '#C62828';
    }

    function finishSoinB() {
        AppState.updateProgress('soin', 100);
        AppState.addBadge('R√âSILIENT üíö');
        AppState.save();
        navigate('accueil');
    }

    // ==================== SYNTH√àSE ====================
    function renderSynthese() {
        const content = document.getElementById('app-content');
        const totalProgress = calculateGlobalProgress();

        content.innerHTML = `
            <div class="passport-section" id="passportContent">
                <div style="text-align: center;">
                    <h1 style="margin-bottom: 16px;">üìã Mon Passeport Comp√©tences</h1>
                    <p style="font-size: 20px; color: #757575; font-weight: 300;">Iparralde 2040 - Mission Locale Pays Basque</p>
                    <div class="progress-bar" style="margin: 30px auto; max-width: 500px;">
                        <div class="progress-fill" style="width: ${totalProgress}%"></div>
                    </div>
                    <p style="font-weight: 700; font-size: 20px; color: var(--rouge-cerise);">Parcours compl√©t√© √† ${totalProgress}%</p>
                </div>

                <div class="badges-collection" style="margin: 60px 0;">
                    <h2 style="width: 100%; text-align: center; margin-bottom: 30px;">üèÜ Mes Badges</h2>
                    ${AppState.badges.length > 0 ? 
                        AppState.badges.map(badge => `
                            <div class="badge-earned">
                                <div class="badge-icon">${badge.includes('RELIEUR') ? 'ü§ù' : badge.includes('CR√âATEUR') ? '‚ú®' : badge.includes('ANCR√â') ? 'üè°' : 'üíö'}</div>
                                <h3 style="margin-top: 12px;">${badge}</h3>
                            </div>
                        `).join('') :
                        '<p style="color: #757575; text-align: center; width: 100%; font-size: 18px;">Compl√®te les modules pour d√©bloquer des badges</p>'
                    }
                </div>

                ${AppState.userData.accueillirA ? `
                    <div class="card">
                        <h2>ü§ù ACCUEILLIR</h2>
                        <h3 style="margin-top: 20px;">Profil relationnel</h3>
                        <p style="margin: 12px 0;"><strong>Ouverture:</strong> ${AppState.userData.accueillirA.scores?.ouverture || 'N/A'}%</p>
                        <p style="margin: 12px 0;"><strong>Clart√©:</strong> ${AppState.userData.accueillirA.scores?.clarte || 'N/A'}%</p>
                        <p style="margin: 12px 0;"><strong>Confiance:</strong> ${AppState.userData.accueillirA.scores?.confiance || 'N/A'}%</p>
                        ${AppState.userData.accueillirA.ajustement ? `
                            <p style="margin-top: 20px;"><strong>Mon ajustement:</strong> ${AppState.userData.accueillirA.ajustement}</p>
                        ` : ''}
                    </div>
                ` : ''}

                ${AppState.userData.creerA ? `
                    <div class="card">
                        <h2>‚ú® CR√âER</h2>
                        <h3 style="margin-top: 20px;">Mes comp√©tences cl√©s</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 20px;">
                            ${AppState.userData.creerA.competences?.map(c => `<span class="badge">${c}</span>`).join('') || ''}
                        </div>
                        ${AppState.userData.creerA.valorisation ? `
                            <p style="margin-top: 20px;"><strong>Valorisation:</strong> ${AppState.userData.creerA.valorisation}</p>
                        ` : ''}
                    </div>
                ` : ''}

                ${AppState.userData.habiterB ? `
                    <div class="card">
                        <h2>üè° HABITER</h2>
                        <h3 style="margin-top: 20px;">Budget mensuel</h3>
                        <p style="margin: 12px 0;"><strong>Net:</strong> ${AppState.userData.habiterB.net}‚Ç¨</p>
                        <p style="margin: 12px 0;"><strong>Reste √† vivre:</strong> ${AppState.userData.habiterB.reste}‚Ç¨</p>
                        <p style="margin: 12px 0;"><strong>Viabilit√©:</strong> ${AppState.userData.habiterB.viability === 'vert' ? '‚úÖ Viable' : AppState.userData.habiterB.viability === 'orange' ? '‚ö†Ô∏è Fragile' : '‚ùå Risqu√©'}</p>
                    </div>
                ` : ''}

                ${AppState.userData.soinA ? `
                    <div class="card">
                        <h2>üíö PRENDRE SOIN</h2>
                        <h3 style="margin-top: 20px;">Arbre de r√©silience</h3>
                        <p style="margin: 12px 0;"><strong>Branches:</strong> ${AppState.userData.soinA.branches?.join(', ') || 'Aucune'}</p>
                        <p style="margin: 12px 0;"><strong>Tronc:</strong> ${AppState.userData.soinA.tronc?.join(', ') || 'Aucun'}</p>
                        <p style="margin: 12px 0;"><strong>Racines:</strong> ${AppState.userData.soinA.racines?.join(', ') || 'Aucune'}</p>
                    </div>
                ` : ''}

                <div class="card" style="margin-top: 60px; text-align: center; background: linear-gradient(135deg, var(--turquoise), var(--menthe)); color: white;">
                    <h3 style="color: white;">üìÖ Date de cr√©ation</h3>
                    <p style="margin-top: 12px; font-size: 20px; font-weight: 700;">${new Date().toLocaleDateString('fr-FR')}</p>
                </div>
            </div>

            <div style="text-align: center; margin-top: 50px;">
                <button class="btn btn-primary" onclick="exportPDF()">
                    üì• T√©l√©charger en PDF
                </button>
                <button class="btn btn-outline" onclick="navigate('accueil')" style="margin-left: 16px;">
                    ‚Üê Retour √† l'accueil
                </button>
            </div>
        `;
    }

    async function exportPDF() {
        showNotification('üìÑ G√©n√©ration du PDF en cours...');
        window.print();
    }

    // ==================== UTILITIES ====================
    function calculateGlobalProgress() {
        const p = AppState.progress;
        return Math.round((p.accueillir + p.creer + p.habiter + p.soin) / 4);
    }

    function showProgress() {
        const modal = `
            <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
                <div class="card" style="max-width: 600px; margin: 20px;" onclick="event.stopPropagation()">
                    <h2>üìä Ma Progression</h2>
                    <div style="margin: 30px 0;">
                        <p style="font-weight: 600; margin-bottom: 8px;">ACCUEILLIR: ${AppState.progress.accueillir}%</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.accueillir}%"></div>
                        </div>

                        <p style="font-weight: 600; margin: 20px 0 8px;">CR√âER: ${AppState.progress.creer}%</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.creer}%"></div>
                        </div>

                        <p style="font-weight: 600; margin: 20px 0 8px;">HABITER: ${AppState.progress.habiter}%</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.habiter}%"></div>
                        </div>

                        <p style="font-weight: 600; margin: 20px 0 8px;">PRENDRE SOIN: ${AppState.progress.soin}%</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${AppState.progress.soin}%"></div>
                        </div>
                    </div>

                    <p style="text-align: center; font-weight: 900; font-size: 24px; color: var(--rouge-cerise); font-family: 'Nunito', sans-serif;">
                        Global: ${calculateGlobalProgress()}%
                    </p>

                    <button class="btn btn-primary" style="width: 100%; margin-top: 30px;" onclick="this.parentElement.parentElement.remove()">
                        Fermer
                    </button>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modal);
    }

    function showNotification(message) {
        const notif = document.createElement('div');
        notif.className = 'notification';
        notif.textContent = message;
        document.body.appendChild(notif);

        setTimeout(() => notif.remove(), 3500);
    }

    // ==================== INIT ====================
    window.addEventListener('hashchange', handleRoute);
    window.addEventListener('load', () => {
        AppState.load();
        handleRoute();
    });
</script>
